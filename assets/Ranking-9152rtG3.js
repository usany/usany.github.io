import{c as N,M as I,j as e,T as M,r as a,q as L,aH as R,U as $,E as U,f as b,g as S,h as D,t as T,m as C,n as H,k as q,V as Q,K as G,aG as K,w as O}from"./index-RpsrhQ7o.js";import{L as w}from"./Lists-Doa7-aNZ.js";function P({changeUserSearch:o}){const l=N(r=>r.languages.value),s=r=>{const{target:{value:m}}=r;o(m)},{colorOne:d,colorTwo:i}=I();return e.jsx("div",{className:"px-5 flex flex-col",children:e.jsx(M,{sx:{bgcolor:i,borderRadius:"5px"},label:l==="ko"?"유저 이름":"User name",onChange:s})})}function V({userObj:o,userSearch:l}){const[s,d]=a.useState([]),[i,r]=a.useState([]),[m,j]=a.useState([]),[x,v]=a.useState(null),[u,p]=a.useState(!1);a.useState(!1);const A=20;a.useEffect(()=>{const B=async()=>{const k=L(b(S,"members"),U("points","desc"),$(A),R(x||"")),f=await D(k),h=f.docs.map((n,g)=>{var c;if(console.log(s.indexOf(n)),s.indexOf(n)===-1)return T(C(H,`${(c=n.data())==null?void 0:c.uid}`)).then(t=>{j([...m,{url:t,index:g}])}).catch(t=>{console.log(t)}),g+1===f.docs.length&&v(n),{...n.data()}});if(d([...s,...h]),i.length===0){const n=q(S,`members/${o.uid}`),c=(await Q(n)).data();console.log(c),h.map((t,E)=>{t.uid===o.uid&&(console.log(t==null?void 0:t.ranking),h[E].rank=E+1)}),r([c])}p(!1)},F=async()=>{const k=L(b(S,"members"),U("points","desc"),R(x||"")),f=await D(k),h=f.docs.map((n,g)=>{var c;if(console.log(s.indexOf(n)),s.indexOf(n)===-1)return T(C(H,`${(c=n.data())==null?void 0:c.uid}`)).then(t=>{j([...m,{url:t,index:g}])}).catch(t=>{console.log(t)}),g+1===f.docs.length&&v(n),{...n.data()}});d([...s,...h]),p(!1)};(u||s.length===0)&&B(),l&&(F(),console.log(l))},[u,l]);const y=()=>{if(document.documentElement.offsetHeight-(window.innerHeight+Math.round(document.documentElement.scrollTop))>10||u){console.log(document.documentElement.offsetHeight);return}else console.log("scroll"),p(!0)};return a.useEffect(()=>(window.addEventListener("scroll",y),()=>window.removeEventListener("scroll",y)),[u]),e.jsx(e.Fragment,{children:l?e.jsx("div",{children:e.jsx(w,{userObj:o,elements:s,multiple:!0,userSearch:l,ranking:!0,handleUser:null})}):e.jsxs("div",{children:[e.jsx(w,{userObj:o,elements:i,multiple:!1,userSearch:null,ranking:!0,handleUser:null}),e.jsx(w,{userObj:o,elements:s,multiple:!0,userSearch:null,ranking:!0,handleUser:null}),u&&e.jsx("div",{className:"flex justify-center text-2xl bg-light-2 dark:bg-dark-2 rounded",children:"로딩"})]})})}function W({userObj:o}){const[l,s]=a.useState(""),d=N(r=>r.languages.value),i=G();return a.useEffect(()=>{i(K(5))}),e.jsxs(e.Fragment,{children:[e.jsx(O,{title:d==="ko"?"유저 랭킹":"User Ranking"}),e.jsx(P,{changeUserSearch:r=>s(r)}),e.jsx(V,{userObj:o,userSearch:l})]})}export{W as default};
