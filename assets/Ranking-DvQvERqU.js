import{c as C,j as e,T as $,r as a,q as E,aJ as R,Z as q,E as U,f as D,g as k,h as b,t as N,m as T,n as A,k as B,W as M,L as Q,a8 as J,w as P}from"./index-C450LYio.js";import{L as S}from"./Lists-CzuI2T8K.js";function W({changeUserSearch:o}){const l=C(r=>r.languages.value),s=r=>{const{target:{value:i}}=r;o(i)};return e.jsx("div",{className:"px-5 flex flex-col",children:e.jsx($,{label:l==="ko"?"유저 이름":"User name",onChange:s})})}function Z({userObj:o,userSearch:l}){const[s,r]=a.useState([]),[i,u]=a.useState([]),[j,v]=a.useState([]),[h,w]=a.useState(null),[g,x]=a.useState(!1);a.useState(!1);const F=20;a.useEffect(()=>{const H=async()=>{const p=E(D(k,"members"),U("points","desc"),q(F),R(h||"")),f=await b(p),m=f.docs.map((n,d)=>{var c;if(console.log(s.indexOf(n)),s.indexOf(n)===-1)return N(T(A,`${(c=n.data())==null?void 0:c.uid}`)).then(t=>{v([...j,{url:t,index:d}])}).catch(t=>{console.log(t)}),d+1===f.docs.length&&w(n),{...n.data()}});if(r([...s,...m]),i.length===0){const n=B(k,`members/${o.uid}`),c=(await M(n)).data();console.log(c),m.map((t,L)=>{t.uid===o.uid&&(console.log(t==null?void 0:t.ranking),m[L].rank=L+1)}),u([c])}x(!1)},I=async()=>{const p=E(D(k,"members"),U("points","desc"),R(h||"")),f=await b(p),m=f.docs.map((n,d)=>{var c;if(console.log(s.indexOf(n)),s.indexOf(n)===-1)return N(T(A,`${(c=n.data())==null?void 0:c.uid}`)).then(t=>{v([...j,{url:t,index:d}])}).catch(t=>{console.log(t)}),d+1===f.docs.length&&w(n),{...n.data()}});r([...s,...m]),x(!1)};(g||s.length===0)&&H(),l&&(I(),console.log(l))},[g,l]);const y=()=>{if(window.innerHeight+Math.round(document.documentElement.scrollTop)!==document.documentElement.offsetHeight||g){console.log(document.documentElement.offsetHeight);return}else console.log("scroll"),x(!0)};return a.useEffect(()=>(window.addEventListener("scroll",y),()=>window.removeEventListener("scroll",y)),[g]),e.jsx(e.Fragment,{children:l?e.jsx("div",{children:e.jsx(S,{userObj:o,elements:s,multiple:!0,userSearch:l,ranking:!0,handleUser:null})}):e.jsxs("div",{children:[e.jsx(S,{userObj:o,elements:i,multiple:!1,userSearch:null,ranking:!0,handleUser:null}),e.jsx(S,{userObj:o,elements:s,multiple:!0,userSearch:null,ranking:!0,handleUser:null}),!g&&e.jsx("div",{className:"p-28"}),g&&e.jsx("div",{className:"flex justify-center text-2xl p-28 bg-light-2 dark:bg-dark-2 rounded",children:"로딩"})]})})}function K({userObj:o}){const[l,s]=a.useState(""),r=C(u=>u.languages.value),i=Q();return a.useEffect(()=>{i(J(5))}),e.jsxs(e.Fragment,{children:[e.jsx(P,{title:r==="ko"?"유저 랭킹":"User Ranking"}),e.jsx(W,{changeUserSearch:u=>s(u)}),e.jsx(Z,{userObj:o,userSearch:l})]})}export{K as default};
