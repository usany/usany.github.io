import{r as a,j as e,a2 as L,be as E,a3 as I,a4 as D,a1 as R,X as p,a5 as U,ax as b,au as N,av as T,W as $,Y as B,S as M,ak as P}from"./index-J0Gka_Gw.js";import{P as Q}from"./PageTitle-G-kA0ark.js";import{L as S}from"./Lists-DBkWLmlH.js";import{T as q}from"./TextField-Dd1c130S.js";function W({userObj:o,userSearch:l}){const[s,c]=a.useState([]),[u,A]=a.useState([]),[j,k]=a.useState([]),[m,v]=a.useState(null),[i,h]=a.useState(!1);a.useState(!1);const C=20;a.useEffect(()=>{const F=async()=>{const x=L(R(p,"members"),D("points","desc"),I(C),E(m||"")),g=await U(x),f=g.docs.map((t,d)=>{var r;if(console.log(s.indexOf(t)),s.indexOf(t)===-1)return b(N(T,`${(r=t.data())==null?void 0:r.uid}`)).then(n=>{k([...j,{url:n,index:d}])}).catch(n=>{console.log(n)}),d+1===g.docs.length&&v(t),{...t.data()}});if(c([...s,...f]),u.length===0){const t=$(p,`members/${o.uid}`),r=(await B(t)).data();console.log(r),f.map((n,y)=>{n.uid===o.uid&&(console.log(n==null?void 0:n.ranking),f[y].rank=y+1)}),A([r])}h(!1)},H=async()=>{const x=L(R(p,"members"),D("points","desc"),E(m||"")),g=await U(x),f=g.docs.map((t,d)=>{var r;if(console.log(s.indexOf(t)),s.indexOf(t)===-1)return b(N(T,`${(r=t.data())==null?void 0:r.uid}`)).then(n=>{k([...j,{url:n,index:d}])}).catch(n=>{console.log(n)}),d+1===g.docs.length&&v(t),{...t.data()}});c([...s,...f]),h(!1)};(i||s.length===0)&&F(),l&&(H(),console.log(l))},[i,l]);const w=()=>{if(window.innerHeight+Math.round(document.documentElement.scrollTop)!==document.documentElement.offsetHeight||i){console.log(document.documentElement.offsetHeight);return}else console.log("scroll"),h(!0)};return a.useEffect(()=>(window.addEventListener("scroll",w),()=>window.removeEventListener("scroll",w)),[i]),e.jsx(e.Fragment,{children:l?e.jsx("div",{children:e.jsx(S,{userObj:o,elements:s,multiple:!0,userSearch:l,ranking:!0,handleUser:null})}):e.jsxs("div",{children:[e.jsx(S,{userObj:o,elements:u,multiple:!1,userSearch:null,ranking:!0,handleUser:null}),e.jsx(S,{userObj:o,elements:s,multiple:!0,userSearch:null,ranking:!0,handleUser:null}),!i&&e.jsx("div",{className:"p-28"}),i&&e.jsx("div",{className:"flex justify-center text-2xl p-28",children:"loading"})]})})}function X({changeUserSearch:o}){const l=s=>{const{target:{value:c}}=s;o(c)};return e.jsx("div",{className:"px-5 flex flex-col",children:e.jsx(q,{label:"유저 이름",onChange:l})})}function K({userObj:o}){const[l,s]=a.useState(""),c=M();return a.useEffect(()=>{c(P(5))}),e.jsxs(e.Fragment,{children:[e.jsx(Q,{title:"유저 랭킹"}),e.jsx(X,{changeUserSearch:u=>s(u)}),e.jsx(W,{userObj:o,userSearch:l})]})}export{K as default};
