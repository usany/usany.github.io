import{b2 as Se,u as ie,c as te,O as pe,aV as se,r as m,j as e,P as me,b1 as fe,Y as oe,X as we,b3 as ye,aX as Pe,v as _,m as U,I as L,$ as J,a_ as ke,l as ae,C as ee,b4 as Me,N as ue,B as ne,b5 as ze,q as ce,Z as re,_ as de,n as ge,aY as Ce,s as Ee,S as Te,Q as Ne,D as $e,b6 as Re,aJ as Fe,aa as Be,b7 as Ve,b8 as Ae,b9 as He,ba as _e}from"./index-DAB0w_cW.js";/**
 * @license lucide-react v0.381.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=Se("AlarmClockCheck",[["circle",{cx:"12",cy:"13",r:"8",key:"3y4lt7"}],["path",{d:"M5 3 2 6",key:"18tl5t"}],["path",{d:"m22 6-3-3",key:"1opdir"}],["path",{d:"M6.38 18.7 4 21",key:"17xu3x"}],["path",{d:"M17.64 18.67 20 21",key:"kv2oe2"}],["path",{d:"m9 13 2 2 4-4",key:"6343dt"}]]);/**
 * @license lucide-react v0.381.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=Se("CirclePlus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]),qe={ko:"메세지를 작성해 주세요",en:"Input message"},Ke={ko:"전송",en:"send"};function Ze({chattingUser:s,userObj:r,multiple:z,messages:t,handleMessages:i,messagesList:S,handleMessagesList:c}){const D=ie(d=>d.profileColor.value),V=ie(d=>d.piazzaForm.value),n=te(d=>d.profile.value),A=pe(),{state:C}=se(),x=C==null?void 0:C.conversation,M=te(d=>d.languages.value),$=M==="ko"||M==="en"?M:"ko",[v,y]=m.useState(!1),P=async d=>{var N;d.preventDefault();const j=t,E=r.uid,R=r.displayName,k=Date.now(),a=new Date().toString(),l=n==null?void 0:n.profileImageUrl,o=n==null?void 0:n.defaultProfile,w=n==null?void 0:n.profileImage;let f,h,g;s&&(f=_(U,`members/${s.uid}`),h=await L(f),g=(N=h.data())==null?void 0:N.messagingToken);const u=n.profileImage?n.profileImageUrl:n.defaultProfile;console.log(n);const p={msg:j,userUid:E,id:R,messageClockNumber:k,messageClock:a,conversation:x,conversationUid:s==null?void 0:s.uid,conversationName:s==null?void 0:s.displayName,profileImage:w,defaultProfile:o,profileImageUrl:l,profileUrl:u,sendingToken:g};z?p&&j&&(J.emit("piazzaMessage",p),Z()):j&&(S.length!==0?(J.emit("message",p),console.log("message")):(J.emit("messageNew",p),console.log("messageNew")),b(),O()),i("")},T=d=>{i(d.target.value)},Z=async()=>{try{const d=t,j=r.uid,E=r.displayName,R=new Date().toString(),k=Date.now(),a=n==null?void 0:n.profileImageUrl,l=n==null?void 0:n.defaultProfile,o=n==null?void 0:n.profileImage;d&&(await ke(ae(U,"chats_group"),{userUid:j,userName:E,message:d,messageClock:R,messageClockNumber:k,profileImageUrl:a,defaultProfile:l,profileColor:D,piazzaChecked:[r.uid],profileImage:o}),c(w=>[...w,{msg:d,type:"me",userUid:r.uid,id:r.displayName,messageClock:R,conversation:null,profileColor:D,messageClockNumber:k,defaultProfile:l,profileImageUrl:a,profileImage:o||!1}]))}catch(d){console.log(d)}},b=async()=>{var j,E,R;const d=t;try{const k=r.uid,a=r.displayName,l=Date.now(),o=new Date().toString(),w=n.profileImage,f=s.profileImage,h=n.profileImageUrl,g=s.profileImageUrl,u=n.defaultProfile,p=s.defaultProfile;let N,I,H,F,B,Y,Q,G,X,q;if(r.uid<s.uid?(N=r.uid,I=s.uid,H=r.displayName,F=s.displayName,B=h,Y=g,Q=u,G=p,X=n.profileImage,q=s.profileImage):(N=s.uid,I=r.uid,H=s.displayName,F=r.displayName,B=g,Y=h,Q=p,G=u,X=s.profileImage,q=n.profileImage),!B){const K=_(U,`members/${N}`);B=(j=(await L(K)).data())==null?void 0:j.profileImageUrl}if(!Y){const K=_(U,`members/${I}`);Y=(E=(await L(K)).data())==null?void 0:E.profileImageUrl}if(d){const K={userUid:k,userName:a,message:d,messageClock:o,messageClockNumber:l,userOne:N,userTwo:I,userOneDisplayName:H,userTwoDisplayName:F,userOneProfileUrl:B,userTwoProfileUrl:Y,userOneDefaultProfile:Q,userTwoDefaultProfile:G,userOneProfileImage:X,userTwoProfileImage:q};await ke(ae(U,`chats_${x}`),K);const W=_(U,`members/${k}`),xe=(await L(W)).data().chattings||{},ve=_(U,`members/${s.uid}`),le=(await L(ve)).data().chattings||{},be=((R=le[x])==null?void 0:R.messageCount)||0;xe[x]=K,le[x]={...K,messageCount:be+1},await ee(W,{chattings:xe}),await ee(ve,{chattings:le}),c(Ue=>[...Ue,{msg:d,type:"me",userUid:r.uid,id:r.displayName,messageClock:o,conversation:x,userName:a,messageClockNumber:l,userOne:N,userTwo:I,userOneDisplayName:H,userTwoDisplayName:F,userOneProfileUrl:B,userTwoProfileUrl:Y,userOneDefaultProfile:Q,userTwoDefaultProfile:G,userOneProfileImage:X,userTwoProfileImage:q}])}}catch(k){console.log(k)}},O=async()=>{try{const d=r.uid,j=s.uid,E=_(U,`members/${d}`),k=(await L(E)).data().conversation||[],a=_(U,`members/${j}`),o=(await L(a)).data().conversation||[];k.indexOf(x)===-1&&(await ee(E,{conversation:[...k,x]}),A(Me())),o.indexOf(x)===-1&&await ee(a,{conversation:[...o,x]})}catch(d){console.log(d)}};return m.useEffect(()=>{if(v){document.getElementById("mute"),document.getElementById("stream");const d=document.getElementById("videoInput");document.getElementById("myFace");let j;async function E(){try{const k={video:!0,audio:!0};j=await navigator.mediaDevices.getUserMedia(k),j.getVideoTracks().forEach(a=>a.enabled=!a.enabled),j.getAudioTracks().forEach(a=>a.enabled=!a.enabled),R()}catch(k){console.log(k)}}E();async function R(){try{const a=(await navigator.mediaDevices.enumerateDevices()).filter(l=>l.kind==="videoinput");a.forEach(l=>{const o=document.createElement("option");o.value=l.deviceId,o.innerText=l.label,d==null||d.appendChild(o)}),console.log(a)}catch(k){console.log(k)}}}}),e.jsx(e.Fragment,{children:e.jsxs("form",{className:`fixed w-screen ${V?"bottom-0":"bottom-[60px]"} flex gap-px`,onSubmit:P,children:[x&&x!=="piazza"&&e.jsx(me,{trigger:e.jsx("button",{className:"px-1 h-full rounded bg-light-2 dark:bg-dark-2",type:"submit",children:e.jsx(Ye,{})}),title:e.jsx("div",{children:"전화 선택"}),content:e.jsxs("div",{className:"flex justify-center gap-5 p-5",children:[e.jsx(fe,{children:e.jsx(oe,{to:`/piazza?id=${x}?calls=video`,children:e.jsx(we,{className:"colorOne",sx:{height:"100%"},children:e.jsx(ye,{children:e.jsxs("div",{className:"flex flex-col items-center gap-5",onClick:()=>{var d;(d=document.getElementById("calls"))==null||d.click()},children:[e.jsx(Pe,{}),e.jsx("div",{children:"화상 전화"})]})})})})}),e.jsx(fe,{children:e.jsx(oe,{to:`/piazza?id=${x}?calls=audio`,children:e.jsx(we,{className:"colorOne",sx:{height:"100%"},children:e.jsx(ye,{children:e.jsxs("div",{className:"flex flex-col items-center gap-5",children:[e.jsx(Le,{}),e.jsx("div",{children:"음성 전화"})]})})})})})]})}),e.jsx("input",{className:"w-full p-3 rounded bg-light-1 dark:bg-dark-1",placeholder:qe[$],onChange:T,value:t,autoFocus:!0}),e.jsx("button",{className:"w-1/6 rounded bg-light-2 dark:bg-dark-2",type:"submit",children:Ke[$]})]})})}const Ie=({initiateContinuing:s,multiple:r,handleMultiple:z,user:t,userObj:i,handleMessagesList:S,displayedName:c})=>{const{state:D}=se(),V=(D==null?void 0:D.conversation)||"piazza",n=te(x=>x.languages.value),[A,C]=m.useState("");return m.useEffect(()=>{t&&((t==null?void 0:t.uid)<i.uid?C((t==null?void 0:t.uid[0])+(t==null?void 0:t.uid[1])+(t==null?void 0:t.uid[2])+(t==null?void 0:t.uid[3])+(t==null?void 0:t.uid[4])+(t==null?void 0:t.uid[5])+i.uid[0]+i.uid[1]+i.uid[2]+i.uid[3]+i.uid[4]+i.uid[5]):C(i.uid[0]+i.uid[1]+i.uid[2]+i.uid[3]+i.uid[4]+i.uid[5]+(t==null?void 0:t.uid[0])+(t==null?void 0:t.uid[1])+(t==null?void 0:t.uid[2])+(t==null?void 0:t.uid[3])+(t==null?void 0:t.uid[4])+(t==null?void 0:t.uid[5])))},[t]),e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-col items-center pt-5",children:[e.jsx(ue,{element:t,uid:i.uid,profile:!0,profileColor:"",profileUrl:t==null?void 0:t.profileImageUrl,fallback:"",piazza:null}),e.jsx("div",{children:t==null?void 0:t.displayName}),(t==null?void 0:t.displayName)!==c&&e.jsx("div",{children:n==="ko"?e.jsxs("div",{children:["(",c,"에서 개명)"]}):e.jsxs("div",{children:["(Changed name from ",c,")"]})})]}),e.jsxs("div",{className:"flex justify-center p-5",children:[e.jsx(oe,{to:`/profile?id=${t==null?void 0:t.uid}`,state:{element:t},children:e.jsx(ne,{variant:"outlined",onClick:()=>{},children:n==="ko"?"프로필 확인":"Check Profile"})}),V==="piazza"&&i.uid!==(t==null?void 0:t.uid)&&e.jsx(oe,{to:`${location.pathname}?id=${A}`,state:{conversation:A,displayName:t==null?void 0:t.displayName,userUid:i.uid,chattingUid:t==null?void 0:t.uid,multiple:!1,profileUrl:t==null?void 0:t.profileImageUrl},children:e.jsx(fe,{children:e.jsx(ne,{variant:"outlined",onClick:()=>{S([]),z(!1),s()},children:n==="ko"?"개인 대화":"Private messaging"})})})]})]})};function De({userObj:s,multiple:r,handleMultiple:z,messagesList:t,handleMessagesList:i}){const S=m.useRef(null),c=m.useRef(null),[D,V]=m.useState(null),[n,A]=m.useState(""),[C,x]=m.useState(!1),[M,$]=m.useState(null),[v,y]=m.useState(0),[P,T]=m.useState("piazza"),{state:Z}=se(),b=(Z==null?void 0:Z.conversation)||"piazza";m.useEffect(()=>{P!==b&&(i([]),$(null),y(0),T(b))},[b]);const O=te(a=>a.languages.value),d=async({userUid:a,displayName:l})=>{const o=_(U,`members/${a}`),f=(await L(o)).data();V(f),A(l),console.log("practice")},j=({userUid:a,displayName:l})=>{var o;(o=document.getElementById("drawer"))==null||o.click(),d({userUid:a,displayName:l})},E=20;m.useEffect(()=>{if(!J)return;function a(l){const{msg:o,userUid:w,id:f,target:h,messageClock:g,messageClockNumber:u,profileImageUrl:p,defaultProfile:N,profileImage:I,conversation:H}=l;i(F=>[...F,{msg:o,type:h?"private":"other",userUid:w,id:f,messageClock:g,messageClockNumber:u,conversation:null,profileImageUrl:p,defaultProfile:N,profileImage:I}])}return J.on("sMessagePiazza",a),()=>{J.off("sMessagePiazza",a)}},[]),m.useEffect(()=>{if(!J)return;function a(l){const{msg:o,userUid:w,id:f,target:h,messageClock:g,messageClockNumber:u,conversation:p,profileImageUrl:N,defaultProfile:I,profileImage:H,piazzaData:F}=l;i(B=>[...B,{msg:o,type:h?"private":"other",userUid:w,id:f,messageClock:g,messageClockNumber:u,conversation:null,profileImageUrl:N,defaultProfile:I,profileImage:H,...F}])}return J.on(`sMessage${b}`,a),()=>{J.off(`sMessage${b}`,a)}},[]),m.useEffect(()=>{document.documentElement.scrollTo({top:0,left:0,behavior:"instant"})},[]),m.useEffect(()=>{R(),(async()=>{if(r){const l=ae(U,"chats_group"),o=ce(l,de("messageClockNumber","desc"),re(1));(await ge(o)).forEach(async f=>{const h=_(U,`chats_group/${f.id}`),u=(await L(h)).data(),p=u.piazzaChecked||[];p.indexOf(s.uid)===-1&&(p.splice(-1,s.uid,0),p.push(s.uid),await ee(h,{...u,piazzaChecked:p}))})}else{const l=_(U,`members/${s.uid}`),w=(await L(l)).data().chattings;w[b]&&(w[b].messageCount=0),await ee(l,{chattings:w})}})()},[t]);const R=()=>{var a;(a=S.current)==null||a.scrollIntoView()};m.useEffect(()=>{const a=async()=>{const o=[],w=ae(U,"chats_group"),f=ce(w,de("messageClockNumber","desc"),re(E),Ce(M||"")),h=await ge(f);h.docs.length||y(h.docs.length),h.forEach(g=>{var G,X,q;o.length===h.docs.length-1&&($(g),y(h.docs.length-1));const u=g.data().message,p=g.data().userUid,N=g.data().userName,I=g.data().messageClock,H=g.data().messageClockNumber,F=(G=g.data())==null?void 0:G.profileImageUrl,B=(X=g.data())==null?void 0:X.defaultProfile,Y=(q=g.data())==null?void 0:q.profileImage,Q=g.data();o.push({msg:u,userUid:p,id:N,messageClockNumber:H,messageClock:I,conversation:null,profileImageUrl:F,defaultProfile:B,profileImage:Y||!1,...Q})}),o.reverse(),i([...o,...t]),x(!1)},l=async o=>{const w=ae(U,`chats_${o}`),f=ce(w,de("messageClockNumber","desc"),re(E),Ce(M||"")),h=await ge(f),g=[];h.docs.length||y(h.docs.length),h.forEach((u,p)=>{var q,K,W;g.length===h.docs.length-1&&($(u),y(h.docs.length-1));const N=u.data().message,I=u.data().userUid,H=u.data().userName,F=u.data().messageClock,B=u.data().messageClockNumber||0,Y=(q=u.data())==null?void 0:q.profileImageUrl,Q=(K=u.data())==null?void 0:K.defaultProfile,G=(W=u.data())==null?void 0:W.profileImage,X=u.data();g.push({msg:N,userUid:I,id:H,messageClockNumber:B,messageClock:F,conversation:null,profileImageUrl:Y,defaultProfile:Q,profileImage:G||!1,...X})}),g.reverse(),i([...g,...t]),x(!1)};b==="piazza"?(C||!t.length)&&a():(C||!t.length)&&l(b)},[C,b]);const k=()=>{c.current.scrollTop!==0||C||(console.log("scroll"),x(!0))};return m.useEffect(()=>{var a;return(a=c.current)==null||a.addEventListener("scroll",k),()=>{var l;return(l=c.current)==null?void 0:l.removeEventListener("scroll",k)}},[C]),console.log(b),console.log(t),console.log(D),e.jsx(e.Fragment,{children:e.jsx("div",{ref:c,className:"p-1 border-t rounded-xl overflow-auto",children:e.jsxs("ul",{children:[C&&e.jsx("div",{className:"flex justify-center bg-light-2 dark:bg-dark-2 rounded",children:"로딩"}),t.map((a,l)=>{let o;b==="piazza"?o=a:a.userUid===a.userOne?o={userUid:a.userOne,id:a.userOneDisplayName,profileImage:a.userOneProfileImage||a.profileImage,defaultProfile:a.userOneDefaultProfile||a.defaultProfile,profileImageUrl:a.userOneProfileUrl||a.profileImageUrl}:o={userUid:a.userTwo,id:a.userTwoDisplayName,profileImage:a.userTwoProfileImage||a.profileImage,defaultProfile:a.userTwoDefaultProfile||a.defaultProfile,profileImageUrl:a.userTwoProfileUrl||a.profileImageUrl};let w;const f=new Date(a.messageClock);a.userUid===s.uid?w="text-right":w="text-left";let h,g;l>0&&(h=t[l-1].userUid),l<t.length-1&&t[l+1].userUid===s.uid&&(g=new Date(t[l+1].messageClock),f.getFullYear()===g.getFullYear()&&f.getMonth()===g.getMonth()&&f.getDate()===g.getDate()&&f.getHours()===g.getHours()&&(f.getMinutes(),g.getMinutes()));let u,p=f.getHours(),N=(f.getMonth()+1).toString(),I=f.getDate().toString();return p>=13?(u="오후",p!==12&&(p=p-12)):(u="오전",p===0&&(p=p+12)),f.getMonth()+1<10&&(N="0"+N),I.length===1&&(I="0"+I),e.jsxs("li",{ref:l===v?S:null,className:w,children:[h!==a.userUid&&e.jsx("div",{children:e.jsx("div",{className:`flex justify-${a.userUid!==s.uid?"start":"end"}`,children:w==="text-left"?e.jsxs("div",{className:"flex gap-3",children:[e.jsx(me,{trigger:e.jsx(ue,{element:o,piazza:()=>j({userUid:o.userUid,displayName:o.id}),profile:!1}),title:e.jsx(ze,{}),content:e.jsx(Ie,{initiateContinuing:()=>$(null),multiple:r,handleMultiple:z,user:D,userObj:s,handleMessagesList:i,displayedName:n})}),e.jsx("div",{children:a.id})]}):e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{children:a.id}),e.jsx(me,{trigger:e.jsx(ue,{element:o,piazza:()=>j({userUid:o.userUid,displayName:o.id}),profile:!1}),title:e.jsx(ze,{}),content:e.jsx(Ie,{initiateContinuing:()=>$(null),multiple:r,handleMultiple:z,user:D,userObj:s,handleMessagesList:i,displayedName:n})})]})})}),a.userUid!==s.uid?e.jsxs("div",{className:"flex gap-3 justify-start",children:[e.jsx("div",{className:"other rounded-tr-lg rounded-bl-lg rounded-br-lg p-1 bg-light-1 dark:bg-dark-1",children:a.msg}),e.jsxs("div",{children:[f.getFullYear(),"-",N,"-",I," ",O==="ko"&&u," ",p,":",f.getMinutes()<10&&"0",f.getMinutes(),O==="en"&&(u==="오전"?"am":"pm")]})]}):e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsxs("div",{children:[f.getFullYear(),"-",N,"-",I," ",O==="ko"&&u," ",p,":",f.getMinutes()<10&&"0",f.getMinutes(),O==="en"&&(u==="오전"?"am":"pm")]}),e.jsx("div",{className:"me rounded-tl-lg rounded-bl-lg rounded-br-lg p-1 bg-light-1 dark:bg-dark-1",children:a.msg})]})]},l)}),e.jsx("li",{ref:S})]})})})}function Ge({isKeyboardOpen:s,userObj:r,multiple:z,handleMultiple:t,messagesList:i,handleMessagesList:S}){return e.jsx(e.Fragment,{children:s?e.jsx("div",{className:"fixed bottom-[50px] w-screen h-full bg-light-3 dark:bg-dark-3 flex flex-col pt-[120px]",children:e.jsx(De,{userObj:r,multiple:z,handleMultiple:t,messagesList:i,handleMessagesList:S})}):e.jsx("div",{className:"fixed bottom-[110px] w-screen h-[60%] bg-light-3 dark:bg-dark-3 flex flex-col",children:e.jsx(De,{userObj:r,multiple:z,handleMultiple:t,messagesList:i,handleMessagesList:S})})})}const Xe=Ee(Te)(({theme:s})=>({padding:8,"& .MuiSwitch-track":{borderRadius:22/2,"&::before, &::after":{content:'""',position:"absolute",top:"50%",transform:"translateY(-50%)",width:16,height:16},"&::before":{backgroundImage:`url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" height="16" width="16" viewBox="0 0 24 24"><path fill="${encodeURIComponent(s.palette.getContrastText(s.palette.primary.main))}" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"/></svg>')`,left:12},"&::after":{backgroundImage:`url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" height="16" width="16" viewBox="0 0 24 24"><path fill="${encodeURIComponent(s.palette.getContrastText(s.palette.primary.main))}" d="M19,13H5V11H19V13Z" /></svg>')`,right:12}},"& .MuiSwitch-thumb":{boxShadow:"none",width:16,height:16,margin:2}}));function Je(){const s=te(i=>i.languages.value),r=ie(i=>i.piazzaSwitch.value),z=pe(),t=()=>{r==="true"?(window.localStorage.setItem("piazza","false"),z(Ne("false"))):(window.localStorage.setItem("piazza","true"),z(Ne("true")))};return e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"text-sm",children:s==="ko"?"단체 대화 알림 받기":"Receive Group Messaging notice"}),e.jsx("div",{className:"flex justify-end",children:e.jsx(Xe,{onClick:()=>t(),inputProps:{"aria-label":"ant design"},checked:r==="true"})})]})}const je={ko:["단체 대화","개인 대화"],en:["Group Messaging","Messaging"]},Qe=({multiple:s,displayName:r})=>{const z=te(c=>c.languages.value),t=z==="ko"||z==="en"?z:"ko",{state:i}=se(),S=(i==null?void 0:i.conversation)||"piazza";return e.jsxs("div",{className:"flex w-screen justify-between",children:[e.jsx($e,{icon:e.jsx(Re,{}),title:S==="piazza"?je[t][0]:`${je[t][1]} ${r}`}),s&&e.jsx("div",{className:"flex w-1/2 justify-end px-5 pt-5",children:e.jsx(Je,{})})]})};function We(){const[s,r]=m.useState([]),[z,t]=m.useState(!0),[i,S]=m.useState(!0),c=Fe();document.getElementById("myFace");const D=document.getElementById("mute"),V=document.getElementById("stream"),n=document.getElementById("videoInput"),A={audio:!0,video:!0};let C,x=!1,M=!1;async function $(){C=await navigator.mediaDevices.getUserMedia(A),C.getAudioTracks().forEach(y=>y.enabled=!y.enabled),t(!z),x?(D.innerText="mute",x=!1):(D.innerText="unmute",x=!0)}async function v(){C=await navigator.mediaDevices.getUserMedia(A),C.getVideoTracks().forEach(y=>y.enabled=!y.enabled),S(!i),M?(V.innerText="turn stream off",M=!1):(V.innerText="turn stream on",M=!0)}return m.useEffect(()=>{async function y(){try{const Z=(await navigator.mediaDevices.enumerateDevices()).filter(b=>b.kind==="videoinput");r(Z),console.log(Z)}catch(T){console.log(T)}}async function P(){try{const T={audio:!0,video:!0};C=await navigator.mediaDevices.getUserMedia(T);const Z=await navigator.mediaDevices.enumerateDevices();await y()}catch(T){console.log(T)}}P()},[n]),e.jsxs("div",{id:"myStream",children:[e.jsxs("div",{className:`flex ${!c&&"flex-col"} gap-1`,children:[e.jsx("video",{id:"myFace",width:"320",height:"240",controls:!0,autoPlay:!0}),e.jsx("video",{id:"myFace",width:"320",height:"240",controls:!0,autoPlay:!0})]}),e.jsxs("div",{className:"flex gap-5",children:[e.jsx(ne,{onClick:$,children:z?"unmute":"mute"}),e.jsx(ne,{onClick:v,children:i?"turn stream on":"turn stream off"})]}),e.jsx("select",{children:s.map((y,P)=>e.jsx("option",{value:y.deviceId,children:y.label},P))})]})}function tt({userObj:s}){const[r,z]=m.useState(""),[t,i]=m.useState([]),S=pe(),{state:c}=se(),[D,V]=m.useState(!0),[n,A]=m.useState(!1),[C,x]=m.useState(null);c!=null&&c.conversation,console.log(c),m.useEffect(()=>{const v=async()=>{if(c!=null&&c.chattingUid){const y=_(U,`members/${c.chattingUid}`),P=await L(y);x(P.data())}};c!=null&&c.multiple||v()},[c]);const M=ie(v=>v.piazzaForm.value);m.useEffect(()=>{var y;const v=()=>{var T;const P=window.screen.height-300>(((T=window.visualViewport)==null?void 0:T.height)||window.screen.height);n!==P&&A(P)};return window.addEventListener("resize",v),typeof visualViewport<"u"&&((y=window.visualViewport)==null||y.addEventListener("resize",v)),visualViewport==null||visualViewport.addEventListener("resize",v),typeof visualViewport<"u"&&(visualViewport==null||visualViewport.addEventListener("resize",v)),()=>{var P;typeof visualViewport<"u"&&((P=window.visualViewport)==null||P.removeEventListener("resize",v))}},[n]),m.useEffect(()=>{(c==null?void 0:c.multiple)!==void 0&&V(c==null?void 0:c.multiple)},[]),m.useEffect(()=>{S(Be(5))});const $=c==null?void 0:c.displayName;return e.jsxs(e.Fragment,{children:[!n&&e.jsx(Qe,{multiple:D,displayName:$}),e.jsx(Ge,{isKeyboardOpen:M,userObj:s,multiple:D,handleMultiple:v=>V(v),messagesList:t,handleMessagesList:v=>i(v)}),e.jsx(Ze,{chattingUser:C,userObj:s,multiple:D,messages:r,handleMessages:v=>z(v),messagesList:t,handleMessagesList:v=>i(v)}),e.jsxs(Ve,{children:[e.jsx(Ae,{children:e.jsx("div",{id:"calls"})}),e.jsx(He,{children:e.jsxs("div",{children:[e.jsx("div",{className:"flex gap-5",children:e.jsx(We,{})}),e.jsx(_e,{children:e.jsx("div",{children:"전화 종료"})})]})})]})]})}export{tt as default};
