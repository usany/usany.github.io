import{r as n,j as t,ay as W,aA as X,ax as G,O as I,ab as S,v as J,bl as O,M as k,a0 as P,bm as L,N as w,aL as aa,aN as ea,Q as ta,S as j,U as ia,aK as sa,W as E,X as na,Y as oa,Z as la}from"./index-DmmIGfxw.js";const ca=({selectUser:i,user:a,handleClose:d,userObj:s,handleMsgList:x,handleChangeMessage:r,displayedName:f})=>{const[N,p]=n.useState(null);return n.useEffect(()=>{i&&((a==null?void 0:a.uid)<s.uid?p((a==null?void 0:a.uid[0])+(a==null?void 0:a.uid[1])+(a==null?void 0:a.uid[2])+(a==null?void 0:a.uid[3])+(a==null?void 0:a.uid[4])+(a==null?void 0:a.uid[5])+s.uid[0]+s.uid[1]+s.uid[2]+s.uid[3]+s.uid[4]+s.uid[5]):p(s.uid[0]+s.uid[1]+s.uid[2]+s.uid[3]+s.uid[4]+s.uid[5]+(a==null?void 0:a.uid[0])+(a==null?void 0:a.uid[1])+(a==null?void 0:a.uid[2])+(a==null?void 0:a.uid[3])+(a==null?void 0:a.uid[4])+(a==null?void 0:a.uid[5])))},[i]),t.jsxs(W,{open:i,onClose:d,children:[t.jsxs(X,{children:[t.jsx("div",{children:a==null?void 0:a.displayName}),(a==null?void 0:a.displayName)!==f&&t.jsxs("div",{children:["(",f,"에서 개명)"]})]}),t.jsxs(G,{children:[t.jsx(I,{to:"/profile",state:{element:a},children:t.jsx(S,{variant:"outlined",onClick:()=>{d()},children:"프로필 확인"})}),s.uid!==(a==null?void 0:a.uid)&&t.jsx(I,{to:"/chatting",state:{conversation:N,displayName:a==null?void 0:a.displayName,userUid:s.uid,chattingUid:a==null?void 0:a.uid},children:t.jsx(S,{variant:"outlined",onClick:()=>{x([]),r(!0),d()},children:"개인 대화"})}),t.jsx(S,{variant:"outlined",onClick:()=>{d()},children:"닫기"})]})]})},da=J(O)(({theme:i})=>({padding:8,"& .MuiSwitch-track":{borderRadius:22/2,"&::before, &::after":{content:'""',position:"absolute",top:"50%",transform:"translateY(-50%)",width:16,height:16},"&::before":{backgroundImage:`url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" height="16" width="16" viewBox="0 0 24 24"><path fill="${encodeURIComponent(i.palette.getContrastText(i.palette.primary.main))}" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"/></svg>')`,left:12},"&::after":{backgroundImage:`url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" height="16" width="16" viewBox="0 0 24 24"><path fill="${encodeURIComponent(i.palette.getContrastText(i.palette.primary.main))}" d="M19,13H5V11H19V13Z" /></svg>')`,right:12}},"& .MuiSwitch-thumb":{boxShadow:"none",width:16,height:16,margin:2}}));function ma(){const i=k(s=>s.piazzaSwitch.value),a=P(),d=()=>{i==="true"?(window.localStorage.setItem("piazza","false"),a(L("false"))):(window.localStorage.setItem("piazza","true"),a(L("true")))};return t.jsxs("div",{className:"flex flex-col",children:[t.jsx("div",{className:"text-sm",children:"단체 대화 알림 받기"}),t.jsx("div",{className:"flex justify-end",children:t.jsx(da,{onClick:()=>d(),inputProps:{"aria-label":"ant design"},checked:i==="true"})})]})}function ha({userObj:i}){const a=n.useRef(null),[d,s]=n.useState(""),[x,r]=n.useState([]),[f,N]=n.useState(!0),[p,ga]=n.useState(""),[R,T]=n.useState(null),[b,U]=n.useState(!1),C=k(e=>e.profileColor.value),u=k(e=>e.profileUrl.value),[B,$]=n.useState(null),A=P();n.useEffect(()=>{if(!w)return;function e(l){const{msg:o,userUid:m,id:g,target:c,messageClock:h,messageClockNumber:v,conversation:z}=l;console.log(o),r(y=>[...y,{msg:o,type:c?"private":"other",userUid:m,id:g,messageClock:h,messageClockNumber:v,conversation:null,profileImageUrl:u,profileColor:C}])}return w.on("sMessagePiazza",e),()=>{w.off("sMessagePiazza",e)}},[]),n.useEffect(()=>{document.documentElement.scrollTo({top:0,left:0,behavior:"instant"})},[]),n.useEffect(()=>{H()},[x]),n.useEffect(()=>{A(aa(5))});const H=()=>{var e;(e=a.current)==null||e.scrollIntoView()},V=e=>{e.preventDefault();const l=d,o=i.uid,m=i.displayName,g=Date.now(),c=new Date().toString(),h={msg:l,userUid:o,id:m,messageClockNumber:g,messageClock:c,target:p,conversation:null};h&&l&&(w.emit("message",h),Y()),s("")},Z=e=>{s(e.target.value)},_=async({userUid:e,displayName:l})=>{const o=ta(j,`members/${e}`),g=(await ia(o)).data();T(g),U(!0),$(l)},F=()=>{U(!1)},Y=async()=>{try{const e=d,l=i.uid,o=i.displayName,m=new Date().toString(),g=Date.now();e&&(await sa(E(j,"chats_group"),{userUid:l,userName:o,message:e,messageClock:m,messageClockNumber:g,profileImageUrl:u,profileColor:C}),r(c=>[...c,{msg:e,type:"me",userUid:i.uid,id:i.displayName,messageClock:m,conversation:null,profileImageUrl:u,profileColor:C}]))}catch(e){console.log(e)}};return n.useEffect(()=>{f&&((async()=>{const l=[],o=E(j,"chats_group"),m=na(o,oa("messageClockNumber"));(await la(m)).forEach(c=>{var D,M;const h=c.data().message,v=c.data().userUid,z=c.data().userName,y=c.data().messageClock,q=c.data().messageClockNumber,K=(D=c.data())==null?void 0:D.profileColor,Q=(M=c.data())==null?void 0:M.profileImageUrl;l.push({msg:h,type:"me",userUid:v,id:z,messageClockNumber:q,messageClock:y,conversation:null,profileColor:K,profileImageUrl:Q}),r(l)})})(),N(!1))},[f]),t.jsxs("div",{children:[t.jsxs("div",{className:"flex text-2xl p-5",children:[t.jsx("div",{className:"w-screen",children:"단체 대화"}),t.jsx("div",{className:"flex w-2/3 pt-1 justify-end",children:t.jsx(ma,{})})]}),t.jsx("div",{className:"app-container",children:t.jsxs("div",{className:"wrap",children:[t.jsxs("div",{className:"chat-box",children:[t.jsxs("ul",{className:"chat",children:[x.map((e,l)=>{if(e.type==="welcome")return t.jsxs("li",{className:"welcome",children:[t.jsx("div",{className:"line"}),t.jsx("div",{children:e.msg}),t.jsx("div",{className:"line"})]});{let o;return e.userUid===i.uid?o="me":o="other",t.jsxs("li",{className:o,name:e.id,"data-id":e.id,onClick:()=>_({userUid:e.userUid,displayName:e.id}),children:[t.jsx("div",{className:`flex justify-${e.userUid!==i.uid?"start":"end"}`,children:t.jsx(ea,{alt:e.id,sx:{bgcolor:e.profileColor||"#2196f3"},src:e.profileImageUrl||"./src",variant:"rounded"})}),t.jsx("div",{className:e.id===p?"private-user":"userId","data-id":e.id,name:e.id,children:e.id}),e.userUid!==i.uid?t.jsxs("div",{className:"flex justify-start",children:[t.jsx("div",{className:"other","data-id":e.id,name:e.id,children:e.msg}),t.jsx("div",{"data-id":e.id,name:e.id,children:e.messageClock})]}):t.jsxs("div",{className:"flex justify-end",children:[t.jsx("div",{"data-id":e.id,name:e.id,children:e.messageClock}),t.jsx("div",{className:"me","data-id":e.id,name:e.id,children:e.msg})]})]},`${l}_li`)}}),t.jsx("li",{ref:a})]}),t.jsxs("form",{className:"send-form",onSubmit:V,children:[t.jsx("input",{placeholder:"메세지를 작성해 주세요",onChange:Z,value:d,autoFocus:!0}),t.jsx("button",{type:"submit",children:"전송"})]})]}),t.jsx(ca,{selectUser:b,user:R,handleClose:F,userObj:i,handleMsgList:e=>r(e),handleChangeMessage:e=>N(e),displayedName:B})]})})]})}export{ha as default};
