import{b2 as Pe,u as ne,c as oe,O as xe,aV as ie,r as c,j as e,P as ue,Y as le,b1 as pe,X as ke,b3 as Ce,aX as Me,v as L,m as U,I as H,$ as w,a_ as ze,l as se,C as ae,b4 as Te,N as he,B as ce,b5 as Ne,q as de,Z as fe,_ as ge,n as me,aY as De,s as Re,S as $e,Q as Ie,D as Fe,b6 as Ve,aJ as Be,aa as Ae,b7 as Le,b8 as He,b9 as _e,ba as Ye}from"./index-BLYOZfhh.js";/**
 * @license lucide-react v0.381.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=Pe("AlarmClockCheck",[["circle",{cx:"12",cy:"13",r:"8",key:"3y4lt7"}],["path",{d:"M5 3 2 6",key:"18tl5t"}],["path",{d:"m22 6-3-3",key:"1opdir"}],["path",{d:"M6.38 18.7 4 21",key:"17xu3x"}],["path",{d:"M17.64 18.67 20 21",key:"kv2oe2"}],["path",{d:"m9 13 2 2 4-4",key:"6343dt"}]]);/**
 * @license lucide-react v0.381.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=Pe("CirclePlus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]),Ze={ko:"메세지를 작성해 주세요",en:"Input message"},Ge={ko:"전송",en:"send"};function Xe({chattingUser:i,userObj:f,multiple:z,messages:t,handleMessages:n,messagesList:b,handleMessagesList:r}){const S=ne(d=>d.profileColor.value),_=ne(d=>d.piazzaForm.value),l=oe(d=>d.profile.value),Y=xe(),{state:k}=ie(),y=k==null?void 0:k.conversation,E=oe(d=>d.languages.value),$=E==="ko"||E==="en"?E:"ko",[C,T]=c.useState(!1),R=async d=>{var N;d.preventDefault();const D=t,j=f.uid,M=f.displayName,v=Date.now(),a=new Date().toString(),o=l==null?void 0:l.profileImageUrl,s=l==null?void 0:l.defaultProfile,h=l==null?void 0:l.profileImage;let m,x,g;i&&(m=L(U,`members/${i.uid}`),x=await H(m),g=(N=x.data())==null?void 0:N.messagingToken);const u=l.profileImage?l.profileImageUrl:l.defaultProfile;console.log(l);const p={msg:D,userUid:j,id:M,messageClockNumber:v,messageClock:a,conversation:y,conversationUid:i==null?void 0:i.uid,conversationName:i==null?void 0:i.displayName,profileImage:h,defaultProfile:s,profileImageUrl:o,profileUrl:u,sendingToken:g};z?p&&D&&(w.emit("piazzaMessage",p),ee()):D&&(b.length!==0?(w.emit("message",p),console.log("message")):(w.emit("messageNew",p),console.log("messageNew")),P(),Q()),n("")},q=d=>{n(d.target.value)},ee=async()=>{try{const d=t,D=f.uid,j=f.displayName,M=new Date().toString(),v=Date.now(),a=l==null?void 0:l.profileImageUrl,o=l==null?void 0:l.defaultProfile,s=l==null?void 0:l.profileImage;d&&(await ze(se(U,"chats_group"),{userUid:D,userName:j,message:d,messageClock:M,messageClockNumber:v,profileImageUrl:a,defaultProfile:o,profileColor:S,piazzaChecked:[f.uid],profileImage:s}),r(h=>[...h,{msg:d,type:"me",userUid:f.uid,id:f.displayName,messageClock:M,conversation:null,profileColor:S,messageClockNumber:v,defaultProfile:o,profileImageUrl:a,profileImage:s||!1}]))}catch(d){console.log(d)}},P=async()=>{var D,j,M;const d=t;try{const v=f.uid,a=f.displayName,o=Date.now(),s=new Date().toString(),h=l.profileImage,m=i.profileImage,x=l.profileImageUrl,g=i.profileImageUrl,u=l.defaultProfile,p=i.defaultProfile;let N,I,A,F,V,K,W,X,J,Z;if(f.uid<i.uid?(N=f.uid,I=i.uid,A=f.displayName,F=i.displayName,V=x,K=g,W=u,X=p,J=l.profileImage,Z=i.profileImage):(N=i.uid,I=f.uid,A=i.displayName,F=f.displayName,V=g,K=x,W=p,X=u,J=i.profileImage,Z=l.profileImage),!V){const G=L(U,`members/${N}`);V=(D=(await H(G)).data())==null?void 0:D.profileImageUrl}if(!K){const G=L(U,`members/${I}`);K=(j=(await H(G)).data())==null?void 0:j.profileImageUrl}if(d){const G={userUid:v,userName:a,message:d,messageClock:s,messageClockNumber:o,userOne:N,userTwo:I,userOneDisplayName:A,userTwoDisplayName:F,userOneProfileUrl:V,userTwoProfileUrl:K,userOneDefaultProfile:W,userTwoDefaultProfile:X,userOneProfileImage:J,userTwoProfileImage:Z};await ze(se(U,`chats_${y}`),G);const te=L(U,`members/${v}`),we=(await H(te)).data().chattings||{},ye=L(U,`members/${i.uid}`),re=(await H(ye)).data().chattings||{},Ue=((M=re[y])==null?void 0:M.messageCount)||0;we[y]=G,re[y]={...G,messageCount:Ue+1},await ae(te,{chattings:we}),await ae(ye,{chattings:re}),r(Ee=>[...Ee,{msg:d,type:"me",userUid:f.uid,id:f.displayName,messageClock:s,conversation:y,userName:a,messageClockNumber:o,userOne:N,userTwo:I,userOneDisplayName:A,userTwoDisplayName:F,userOneProfileUrl:V,userTwoProfileUrl:K,userOneDefaultProfile:W,userTwoDefaultProfile:X,userOneProfileImage:J,userTwoProfileImage:Z}])}}catch(v){console.log(v)}},Q=async()=>{try{const d=f.uid,D=i.uid,j=L(U,`members/${d}`),v=(await H(j)).data().conversation||[],a=L(U,`members/${D}`),s=(await H(a)).data().conversation||[];v.indexOf(y)===-1&&(await ae(j,{conversation:[...v,y]}),Y(Te())),s.indexOf(y)===-1&&await ae(a,{conversation:[...s,y]})}catch(d){console.log(d)}};return c.useEffect(()=>{if(C){document.getElementById("mute"),document.getElementById("stream");const d=document.getElementById("videoInput");document.getElementById("myFace");let D;async function j(){try{const v={video:!0,audio:!0};D=await navigator.mediaDevices.getUserMedia(v),D.getVideoTracks().forEach(a=>a.enabled=!a.enabled),D.getAudioTracks().forEach(a=>a.enabled=!a.enabled),M()}catch(v){console.log(v)}}j();async function M(){try{const a=(await navigator.mediaDevices.enumerateDevices()).filter(o=>o.kind==="videoinput");a.forEach(o=>{const s=document.createElement("option");s.value=o.deviceId,s.innerText=o.label,d==null||d.appendChild(s)}),console.log(a)}catch(v){console.log(v)}}}}),console.log(k),e.jsx(e.Fragment,{children:e.jsxs("form",{className:`fixed w-screen ${_?"bottom-0":"bottom-[60px]"} flex gap-px`,onSubmit:R,children:[y&&y!=="piazza"&&e.jsx(ue,{trigger:e.jsx("button",{className:"px-1 h-full rounded bg-light-2 dark:bg-dark-2",type:"submit",children:e.jsx(Ke,{})}),title:e.jsx("div",{children:"전화 선택"}),content:e.jsxs("div",{className:"flex justify-center gap-5 p-5",children:[e.jsx(le,{to:`/piazza?id=${y}?calls=video`,state:k,children:e.jsx(pe,{children:e.jsx(ke,{className:"colorOne",sx:{height:"100%"},children:e.jsx(Ce,{children:e.jsxs("div",{className:"flex flex-col items-center gap-5",onClick:()=>{var d;(d=document.getElementById("calls"))==null||d.click()},children:[e.jsx(Me,{}),e.jsx("div",{children:"화상 전화"})]})})})})}),e.jsx(le,{to:`/piazza?id=${y}?calls=audio`,state:k,children:e.jsx(pe,{children:e.jsx(ke,{className:"colorOne",sx:{height:"100%"},children:e.jsx(Ce,{children:e.jsxs("div",{className:"flex flex-col items-center gap-5",children:[e.jsx(qe,{}),e.jsx("div",{children:"음성 전화"})]})})})})})]})}),e.jsx("input",{className:"w-full p-3 rounded bg-light-1 dark:bg-dark-1",placeholder:Ze[$],onChange:q,value:t,autoFocus:!0}),e.jsx("button",{className:"w-1/6 rounded bg-light-2 dark:bg-dark-2",type:"submit",children:Ge[$]})]})})}const Se=({initiateContinuing:i,multiple:f,handleMultiple:z,user:t,userObj:n,handleMessagesList:b,displayedName:r})=>{const{state:S}=ie(),_=(S==null?void 0:S.conversation)||"piazza",l=oe(y=>y.languages.value),[Y,k]=c.useState("");return c.useEffect(()=>{t&&((t==null?void 0:t.uid)<n.uid?k((t==null?void 0:t.uid[0])+(t==null?void 0:t.uid[1])+(t==null?void 0:t.uid[2])+(t==null?void 0:t.uid[3])+(t==null?void 0:t.uid[4])+(t==null?void 0:t.uid[5])+n.uid[0]+n.uid[1]+n.uid[2]+n.uid[3]+n.uid[4]+n.uid[5]):k(n.uid[0]+n.uid[1]+n.uid[2]+n.uid[3]+n.uid[4]+n.uid[5]+(t==null?void 0:t.uid[0])+(t==null?void 0:t.uid[1])+(t==null?void 0:t.uid[2])+(t==null?void 0:t.uid[3])+(t==null?void 0:t.uid[4])+(t==null?void 0:t.uid[5])))},[t]),e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-col items-center pt-5",children:[e.jsx(he,{element:t,uid:n.uid,profile:!0,profileColor:"",profileUrl:t==null?void 0:t.profileImageUrl,fallback:"",piazza:null}),e.jsx("div",{children:t==null?void 0:t.displayName}),(t==null?void 0:t.displayName)!==r&&e.jsx("div",{children:l==="ko"?e.jsxs("div",{children:["(",r,"에서 개명)"]}):e.jsxs("div",{children:["(Changed name from ",r,")"]})})]}),e.jsxs("div",{className:"flex justify-center p-5",children:[e.jsx(le,{to:`/profile?id=${t==null?void 0:t.uid}`,state:{element:t},children:e.jsx(ce,{variant:"outlined",onClick:()=>{},children:l==="ko"?"프로필 확인":"Check Profile"})}),_==="piazza"&&n.uid!==(t==null?void 0:t.uid)&&e.jsx(le,{to:`${location.pathname}?id=${Y}`,state:{conversation:Y,displayName:t==null?void 0:t.displayName,userUid:n.uid,chattingUid:t==null?void 0:t.uid,multiple:!1,profileUrl:t==null?void 0:t.profileImageUrl},children:e.jsx(pe,{children:e.jsx(ce,{variant:"outlined",onClick:()=>{b([]),z(!1),i()},children:l==="ko"?"개인 대화":"Private messaging"})})})]})]})};function je({userObj:i,multiple:f,handleMultiple:z,messagesList:t,handleMessagesList:n}){const b=c.useRef(null),r=c.useRef(null),[S,_]=c.useState(null),[l,Y]=c.useState(""),[k,y]=c.useState(!1),[E,$]=c.useState(null),[C,T]=c.useState(0),[R,q]=c.useState("piazza"),{state:ee}=ie(),P=(ee==null?void 0:ee.conversation)||"piazza";c.useEffect(()=>{R!==P&&(n([]),$(null),T(0),q(P))},[P]);const Q=oe(a=>a.languages.value),d=async({userUid:a,displayName:o})=>{const s=L(U,`members/${a}`),m=(await H(s)).data();_(m),Y(o),console.log("practice")},D=({userUid:a,displayName:o})=>{var s;(s=document.getElementById("drawer"))==null||s.click(),d({userUid:a,displayName:o})},j=20;c.useEffect(()=>{if(!w)return;function a(o){const{msg:s,userUid:h,id:m,target:x,messageClock:g,messageClockNumber:u,profileImageUrl:p,defaultProfile:N,profileImage:I,conversation:A}=o;n(F=>[...F,{msg:s,type:x?"private":"other",userUid:h,id:m,messageClock:g,messageClockNumber:u,conversation:null,profileImageUrl:p,defaultProfile:N,profileImage:I}])}return w.on("sMessagePiazza",a),()=>{w.off("sMessagePiazza",a)}},[]),c.useEffect(()=>{if(!w)return;function a(o){const{msg:s,userUid:h,id:m,target:x,messageClock:g,messageClockNumber:u,conversation:p,profileImageUrl:N,defaultProfile:I,profileImage:A,piazzaData:F}=o;n(V=>[...V,{msg:s,type:x?"private":"other",userUid:h,id:m,messageClock:g,messageClockNumber:u,conversation:null,profileImageUrl:N,defaultProfile:I,profileImage:A,...F}])}return w.on(`sMessage${P}`,a),()=>{w.off(`sMessage${P}`,a)}},[]),c.useEffect(()=>{document.documentElement.scrollTo({top:0,left:0,behavior:"instant"})},[]),c.useEffect(()=>{M(),(async()=>{if(f){const o=se(U,"chats_group"),s=de(o,ge("messageClockNumber","desc"),fe(1));(await me(s)).forEach(async m=>{const x=L(U,`chats_group/${m.id}`),u=(await H(x)).data(),p=u.piazzaChecked||[];p.indexOf(i.uid)===-1&&(p.splice(-1,i.uid,0),p.push(i.uid),await ae(x,{...u,piazzaChecked:p}))})}else{const o=L(U,`members/${i.uid}`),h=(await H(o)).data().chattings;h[P]&&(h[P].messageCount=0),await ae(o,{chattings:h})}})()},[t]);const M=()=>{var a;(a=b.current)==null||a.scrollIntoView()};c.useEffect(()=>{const a=async()=>{const s=[],h=se(U,"chats_group"),m=de(h,ge("messageClockNumber","desc"),fe(j),De(E||"")),x=await me(m);x.docs.length||T(x.docs.length),x.forEach(g=>{var X,J,Z;s.length===x.docs.length-1&&($(g),T(x.docs.length-1));const u=g.data().message,p=g.data().userUid,N=g.data().userName,I=g.data().messageClock,A=g.data().messageClockNumber,F=(X=g.data())==null?void 0:X.profileImageUrl,V=(J=g.data())==null?void 0:J.defaultProfile,K=(Z=g.data())==null?void 0:Z.profileImage,W=g.data();s.push({msg:u,userUid:p,id:N,messageClockNumber:A,messageClock:I,conversation:null,profileImageUrl:F,defaultProfile:V,profileImage:K||!1,...W})}),s.reverse(),n([...s,...t]),y(!1)},o=async s=>{const h=se(U,`chats_${s}`),m=de(h,ge("messageClockNumber","desc"),fe(j),De(E||"")),x=await me(m),g=[];x.docs.length||T(x.docs.length),x.forEach((u,p)=>{var Z,G,te;g.length===x.docs.length-1&&($(u),T(x.docs.length-1));const N=u.data().message,I=u.data().userUid,A=u.data().userName,F=u.data().messageClock,V=u.data().messageClockNumber||0,K=(Z=u.data())==null?void 0:Z.profileImageUrl,W=(G=u.data())==null?void 0:G.defaultProfile,X=(te=u.data())==null?void 0:te.profileImage,J=u.data();g.push({msg:N,userUid:I,id:A,messageClockNumber:V,messageClock:F,conversation:null,profileImageUrl:K,defaultProfile:W,profileImage:X||!1,...J})}),g.reverse(),n([...g,...t]),y(!1)};P==="piazza"?(k||!t.length)&&a():(k||!t.length)&&o(P)},[k,P]);const v=()=>{r.current.scrollTop!==0||k||(console.log("scroll"),y(!0))};return c.useEffect(()=>{var a;return(a=r.current)==null||a.addEventListener("scroll",v),()=>{var o;return(o=r.current)==null?void 0:o.removeEventListener("scroll",v)}},[k]),console.log(P),console.log(t),console.log(S),e.jsx(e.Fragment,{children:e.jsx("div",{ref:r,className:"p-1 border-t rounded-xl overflow-auto",children:e.jsxs("ul",{children:[k&&e.jsx("div",{className:"flex justify-center bg-light-2 dark:bg-dark-2 rounded",children:"로딩"}),t.map((a,o)=>{let s;P==="piazza"?s=a:a.userUid===a.userOne?s={userUid:a.userOne,id:a.userOneDisplayName,profileImage:a.userOneProfileImage||a.profileImage,defaultProfile:a.userOneDefaultProfile||a.defaultProfile,profileImageUrl:a.userOneProfileUrl||a.profileImageUrl}:s={userUid:a.userTwo,id:a.userTwoDisplayName,profileImage:a.userTwoProfileImage||a.profileImage,defaultProfile:a.userTwoDefaultProfile||a.defaultProfile,profileImageUrl:a.userTwoProfileUrl||a.profileImageUrl};let h;const m=new Date(a.messageClock);a.userUid===i.uid?h="text-right":h="text-left";let x,g;o>0&&(x=t[o-1].userUid),o<t.length-1&&t[o+1].userUid===i.uid&&(g=new Date(t[o+1].messageClock),m.getFullYear()===g.getFullYear()&&m.getMonth()===g.getMonth()&&m.getDate()===g.getDate()&&m.getHours()===g.getHours()&&(m.getMinutes(),g.getMinutes()));let u,p=m.getHours(),N=(m.getMonth()+1).toString(),I=m.getDate().toString();return p>=13?(u="오후",p!==12&&(p=p-12)):(u="오전",p===0&&(p=p+12)),m.getMonth()+1<10&&(N="0"+N),I.length===1&&(I="0"+I),e.jsxs("li",{ref:o===C?b:null,className:h,children:[x!==a.userUid&&e.jsx("div",{children:e.jsx("div",{className:`flex justify-${a.userUid!==i.uid?"start":"end"}`,children:h==="text-left"?e.jsxs("div",{className:"flex gap-3",children:[e.jsx(ue,{trigger:e.jsx(he,{element:s,piazza:()=>D({userUid:s.userUid,displayName:s.id}),profile:!1}),title:e.jsx(Ne,{}),content:e.jsx(Se,{initiateContinuing:()=>$(null),multiple:f,handleMultiple:z,user:S,userObj:i,handleMessagesList:n,displayedName:l})}),e.jsx("div",{children:a.id})]}):e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{children:a.id}),e.jsx(ue,{trigger:e.jsx(he,{element:s,piazza:()=>D({userUid:s.userUid,displayName:s.id}),profile:!1}),title:e.jsx(Ne,{}),content:e.jsx(Se,{initiateContinuing:()=>$(null),multiple:f,handleMultiple:z,user:S,userObj:i,handleMessagesList:n,displayedName:l})})]})})}),a.userUid!==i.uid?e.jsxs("div",{className:"flex gap-3 justify-start",children:[e.jsx("div",{className:"other rounded-tr-lg rounded-bl-lg rounded-br-lg p-1 bg-light-1 dark:bg-dark-1",children:a.msg}),e.jsxs("div",{children:[m.getFullYear(),"-",N,"-",I," ",Q==="ko"&&u," ",p,":",m.getMinutes()<10&&"0",m.getMinutes(),Q==="en"&&(u==="오전"?"am":"pm")]})]}):e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsxs("div",{children:[m.getFullYear(),"-",N,"-",I," ",Q==="ko"&&u," ",p,":",m.getMinutes()<10&&"0",m.getMinutes(),Q==="en"&&(u==="오전"?"am":"pm")]}),e.jsx("div",{className:"me rounded-tl-lg rounded-bl-lg rounded-br-lg p-1 bg-light-1 dark:bg-dark-1",children:a.msg})]})]},o)}),e.jsx("li",{ref:b})]})})})}function Je({isKeyboardOpen:i,userObj:f,multiple:z,handleMultiple:t,messagesList:n,handleMessagesList:b}){return e.jsx(e.Fragment,{children:i?e.jsx("div",{className:"fixed bottom-[50px] w-screen h-full bg-light-3 dark:bg-dark-3 flex flex-col pt-[120px]",children:e.jsx(je,{userObj:f,multiple:z,handleMultiple:t,messagesList:n,handleMessagesList:b})}):e.jsx("div",{className:"fixed bottom-[110px] w-screen h-[60%] bg-light-3 dark:bg-dark-3 flex flex-col",children:e.jsx(je,{userObj:f,multiple:z,handleMultiple:t,messagesList:n,handleMessagesList:b})})})}const Qe=Re($e)(({theme:i})=>({padding:8,"& .MuiSwitch-track":{borderRadius:22/2,"&::before, &::after":{content:'""',position:"absolute",top:"50%",transform:"translateY(-50%)",width:16,height:16},"&::before":{backgroundImage:`url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" height="16" width="16" viewBox="0 0 24 24"><path fill="${encodeURIComponent(i.palette.getContrastText(i.palette.primary.main))}" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"/></svg>')`,left:12},"&::after":{backgroundImage:`url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" height="16" width="16" viewBox="0 0 24 24"><path fill="${encodeURIComponent(i.palette.getContrastText(i.palette.primary.main))}" d="M19,13H5V11H19V13Z" /></svg>')`,right:12}},"& .MuiSwitch-thumb":{boxShadow:"none",width:16,height:16,margin:2}}));function We(){const i=oe(n=>n.languages.value),f=ne(n=>n.piazzaSwitch.value),z=xe(),t=()=>{f==="true"?(window.localStorage.setItem("piazza","false"),z(Ie("false"))):(window.localStorage.setItem("piazza","true"),z(Ie("true")))};return e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"text-sm",children:i==="ko"?"단체 대화 알림 받기":"Receive Group Messaging notice"}),e.jsx("div",{className:"flex justify-end",children:e.jsx(Qe,{onClick:()=>t(),inputProps:{"aria-label":"ant design"},checked:f==="true"})})]})}const be={ko:["단체 대화","개인 대화"],en:["Group Messaging","Messaging"]},Oe=({multiple:i,displayName:f})=>{const z=oe(r=>r.languages.value),t=z==="ko"||z==="en"?z:"ko",{state:n}=ie(),b=(n==null?void 0:n.conversation)||"piazza";return e.jsxs("div",{className:"flex w-screen justify-between",children:[e.jsx(Fe,{icon:e.jsx(Ve,{}),title:b==="piazza"?be[t][0]:`${be[t][1]} ${f}`}),i&&e.jsx("div",{className:"flex w-1/2 justify-end px-5 pt-5",children:e.jsx(We,{})})]})};let O,B;function et(){const[i,f]=c.useState([]),[z,t]=c.useState(!0),[n,b]=c.useState(!0),[r,S]=c.useState(""),[_,l]=c.useState(null);c.useState(null);const Y=Be();document.getElementById("myScreen");const k=document.getElementById("devices"),y={audio:!0,video:!0},E=location.search.slice(4);console.log(location.search.slice(4));async function $(){const o=O;o&&o.getAudioTracks().forEach(s=>s.enabled=!s.enabled),t(!z)}async function C(){const o=O;o&&o.getVideoTracks().forEach(s=>s.enabled=!s.enabled),b(!n)}async function T(){console.log(k.value),O.getTracks().forEach(s=>s.stop()),l(k.value),await q(k.value)}c.useEffect(()=>{q(_)},[k]);async function R(){try{const s=(await navigator.mediaDevices.enumerateDevices()).filter(h=>h.kind==="videoinput");f(s)}catch(o){console.log(o)}}async function q(o){try{const h=o?{audio:!0,video:{deviceId:{exact:o}}}:y;O=await navigator.mediaDevices.getUserMedia(h);const m=await navigator.mediaDevices.enumerateDevices();await R(),S("")}catch(s){console.log(s),S(s)}}function ee(o){console.log("icecandidate"),console.log(o),w.emit("ice",o.candidate,E)}function P(o){console.log("got a stream from peer"),console.log("Peer Stream",o.stream),console.log("My Stream",O)}function Q(){B=new RTCPeerConnection,B.addEventListener("icecandidate",ee),B.addEventListener("addstream",P),O&&O.getTracks().forEach(o=>B.addTrack(o,O))}async function d(){await q(null),Q()}async function D(){await d(),w.emit("joinRoom",E,d)}c.useEffect(()=>{D()},[]);const j=async()=>{console.log("sent the offer"),console.log(B);const o=await B.createOffer();B.setLocalDescription(o),console.log(o),w.emit("offer",o,E)};c.useEffect(()=>{if(w)return w.on("welcome",j),()=>{w.off("welcome",j)}});const M=async o=>{console.log("received the offer"),B.setRemoteDescription(o);const s=await B.createAnswer();console.log("sent the answer"),B.setLocalDescription(s),w.emit("answer",s,E)};c.useEffect(()=>{if(w)return w.on("offer",M),()=>{w.off("offer",M)}});const v=o=>{console.log("received the answer"),B.setRemoteDescription(o)};c.useEffect(()=>{if(w)return w.on("answer",v),()=>{w.off("answer",v)}});const a=o=>{console.log("received candidate"),B.addIceCandidate(o)};return c.useEffect(()=>{if(w)return w.on("ice",a),()=>{w.off("ice",a)}}),e.jsxs("div",{id:"myStream",children:[e.jsxs("div",{className:`flex ${!Y&&"flex-col"} gap-1`,children:[e.jsx("video",{id:"myScreen",width:"320",height:"240",controls:!0,autoPlay:!0}),e.jsx("video",{id:"yourScreen",width:"320",height:"240",controls:!0,autoPlay:!0})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex gap-5",children:[e.jsx(ce,{onClick:$,children:z?"unmute":"mute"}),e.jsx(ce,{onClick:C,children:n?"turn stream on":"turn stream off"})]}),e.jsx("select",{id:"devices",onChange:T,children:i.map((o,s)=>e.jsx("option",{value:o.deviceId,children:o.label},s))})]}),r&&e.jsx("div",{children:r.toString()})]})}function ot({userObj:i}){const[f,z]=c.useState(""),[t,n]=c.useState([]),b=xe(),{state:r}=ie(),[S,_]=c.useState(!0),[l,Y]=c.useState(!1),[k,y]=c.useState(null);r!=null&&r.conversation,console.log(r),c.useEffect(()=>{const C=async()=>{if(r!=null&&r.chattingUid){const T=L(U,`members/${r.chattingUid}`),R=await H(T);y(R.data())}};r!=null&&r.multiple||C()},[r]);const E=ne(C=>C.piazzaForm.value);c.useEffect(()=>{var T;const C=()=>{var q;const R=window.screen.height-300>(((q=window.visualViewport)==null?void 0:q.height)||window.screen.height);l!==R&&Y(R)};return window.addEventListener("resize",C),typeof visualViewport<"u"&&((T=window.visualViewport)==null||T.addEventListener("resize",C)),visualViewport==null||visualViewport.addEventListener("resize",C),typeof visualViewport<"u"&&(visualViewport==null||visualViewport.addEventListener("resize",C)),()=>{var R;typeof visualViewport<"u"&&((R=window.visualViewport)==null||R.removeEventListener("resize",C))}},[l]),c.useEffect(()=>{(r==null?void 0:r.multiple)!==void 0&&_(r==null?void 0:r.multiple)},[]),c.useEffect(()=>{b(Ae(5))});const $=r==null?void 0:r.displayName;return e.jsxs(e.Fragment,{children:[!l&&e.jsx(Oe,{multiple:S,displayName:$}),e.jsx(Je,{isKeyboardOpen:E,userObj:i,multiple:S,handleMultiple:C=>_(C),messagesList:t,handleMessagesList:C=>n(C)}),e.jsx(Xe,{chattingUser:k,userObj:i,multiple:S,messages:f,handleMessages:C=>z(C),messagesList:t,handleMessagesList:C=>n(C)}),e.jsxs(Le,{children:[e.jsx(He,{children:e.jsx("div",{id:"calls"})}),e.jsx(_e,{children:e.jsxs("div",{children:[e.jsx("div",{className:"flex gap-5",children:e.jsx(et,{})}),e.jsx(Ye,{children:e.jsx("div",{children:"전화 종료"})})]})})]})]})}export{ot as default};
