import{b2 as je,u as ie,c as ae,O as pe,aV as se,r as d,j as e,P as me,b1 as fe,Y as oe,X as we,b3 as ye,aX as Pe,v as H,m as P,I as _,$ as X,a_ as ke,l as te,C as ee,b4 as Me,N as ue,B as ne,b5 as ze,q as ce,Z as re,_ as de,n as ge,aY as Ce,s as Ee,S as Te,Q as Ne,D as $e,b6 as Re,aJ as Fe,aa as Ve,b7 as Be,b8 as Ae,b9 as He,ba as _e}from"./index-0g1vom_w.js";/**
 * @license lucide-react v0.381.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=je("AlarmClockCheck",[["circle",{cx:"12",cy:"13",r:"8",key:"3y4lt7"}],["path",{d:"M5 3 2 6",key:"18tl5t"}],["path",{d:"m22 6-3-3",key:"1opdir"}],["path",{d:"M6.38 18.7 4 21",key:"17xu3x"}],["path",{d:"M17.64 18.67 20 21",key:"kv2oe2"}],["path",{d:"m9 13 2 2 4-4",key:"6343dt"}]]);/**
 * @license lucide-react v0.381.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=je("CirclePlus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]),qe={ko:"메세지를 작성해 주세요",en:"Input message"},Ke={ko:"전송",en:"send"};function Ze({chattingUser:i,userObj:g,multiple:z,messages:a,handleMessages:o,messagesList:U,handleMessagesList:r}){const I=ie(s=>s.profileColor.value),L=ie(s=>s.piazzaForm.value),l=ae(s=>s.profile.value),R=pe(),{state:S}=se(),x=S==null?void 0:S.conversation,F=ae(s=>s.languages.value),M=F==="ko"||F==="en"?F:"ko",[v,E]=d.useState(!1),T=async s=>{var N;s.preventDefault();const C=a,b=g.uid,$=g.displayName,k=Date.now(),t=new Date().toString(),c=l==null?void 0:l.profileImageUrl,n=l==null?void 0:l.defaultProfile,w=l==null?void 0:l.profileImage;let f,h,m;i&&(f=H(P,`members/${i.uid}`),h=await _(f),m=(N=h.data())==null?void 0:N.messagingToken);const u=l.profileImage?l.profileImageUrl:l.defaultProfile;console.log(l);const p={msg:C,userUid:b,id:$,messageClockNumber:k,messageClock:t,conversation:x,conversationUid:i==null?void 0:i.uid,conversationName:i==null?void 0:i.displayName,profileImage:w,defaultProfile:n,profileImageUrl:c,profileUrl:u,sendingToken:m};z?p&&C&&(X.emit("piazzaMessage",p),W()):C&&(U.length!==0?(X.emit("message",p),console.log("message")):(X.emit("messageNew",p),console.log("messageNew")),j(),y()),o("")},J=s=>{o(s.target.value)},W=async()=>{try{const s=a,C=g.uid,b=g.displayName,$=new Date().toString(),k=Date.now(),t=l==null?void 0:l.profileImageUrl,c=l==null?void 0:l.defaultProfile,n=l==null?void 0:l.profileImage;s&&(await ke(te(P,"chats_group"),{userUid:C,userName:b,message:s,messageClock:$,messageClockNumber:k,profileImageUrl:t,defaultProfile:c,profileColor:I,piazzaChecked:[g.uid],profileImage:n}),r(w=>[...w,{msg:s,type:"me",userUid:g.uid,id:g.displayName,messageClock:$,conversation:null,profileColor:I,messageClockNumber:k,defaultProfile:c,profileImageUrl:t,profileImage:n||!1}]))}catch(s){console.log(s)}},j=async()=>{var C,b,$;const s=a;try{const k=g.uid,t=g.displayName,c=Date.now(),n=new Date().toString(),w=l.profileImage,f=i.profileImage,h=l.profileImageUrl,m=i.profileImageUrl,u=l.defaultProfile,p=i.defaultProfile;let N,D,A,V,B,Y,Q,Z,G,q;if(g.uid<i.uid?(N=g.uid,D=i.uid,A=g.displayName,V=i.displayName,B=h,Y=m,Q=u,Z=p,G=l.profileImage,q=i.profileImage):(N=i.uid,D=g.uid,A=i.displayName,V=g.displayName,B=m,Y=h,Q=p,Z=u,G=i.profileImage,q=l.profileImage),!B){const K=H(P,`members/${N}`);B=(C=(await _(K)).data())==null?void 0:C.profileImageUrl}if(!Y){const K=H(P,`members/${D}`);Y=(b=(await _(K)).data())==null?void 0:b.profileImageUrl}if(s){const K={userUid:k,userName:t,message:s,messageClock:n,messageClockNumber:c,userOne:N,userTwo:D,userOneDisplayName:A,userTwoDisplayName:V,userOneProfileUrl:B,userTwoProfileUrl:Y,userOneDefaultProfile:Q,userTwoDefaultProfile:Z,userOneProfileImage:G,userTwoProfileImage:q};await ke(te(P,`chats_${x}`),K);const O=H(P,`members/${k}`),xe=(await _(O)).data().chattings||{},ve=H(P,`members/${i.uid}`),le=(await _(ve)).data().chattings||{},be=(($=le[x])==null?void 0:$.messageCount)||0;xe[x]=K,le[x]={...K,messageCount:be+1},await ee(O,{chattings:xe}),await ee(ve,{chattings:le}),r(Ue=>[...Ue,{msg:s,type:"me",userUid:g.uid,id:g.displayName,messageClock:n,conversation:x,userName:t,messageClockNumber:c,userOne:N,userTwo:D,userOneDisplayName:A,userTwoDisplayName:V,userOneProfileUrl:B,userTwoProfileUrl:Y,userOneDefaultProfile:Q,userTwoDefaultProfile:Z,userOneProfileImage:G,userTwoProfileImage:q}])}}catch(k){console.log(k)}},y=async()=>{try{const s=g.uid,C=i.uid,b=H(P,`members/${s}`),k=(await _(b)).data().conversation||[],t=H(P,`members/${C}`),n=(await _(t)).data().conversation||[];k.indexOf(x)===-1&&(await ee(b,{conversation:[...k,x]}),R(Me())),n.indexOf(x)===-1&&await ee(t,{conversation:[...n,x]})}catch(s){console.log(s)}};return d.useEffect(()=>{if(v){document.getElementById("mute"),document.getElementById("stream");const s=document.getElementById("videoInput");document.getElementById("myFace");let C;async function b(){try{const k={video:!0,audio:!0};C=await navigator.mediaDevices.getUserMedia(k),C.getVideoTracks().forEach(t=>t.enabled=!t.enabled),C.getAudioTracks().forEach(t=>t.enabled=!t.enabled),$()}catch(k){console.log(k)}}b();async function $(){try{const t=(await navigator.mediaDevices.enumerateDevices()).filter(c=>c.kind==="videoinput");t.forEach(c=>{const n=document.createElement("option");n.value=c.deviceId,n.innerText=c.label,s==null||s.appendChild(n)}),console.log(t)}catch(k){console.log(k)}}}}),e.jsx(e.Fragment,{children:e.jsxs("form",{className:`fixed w-screen ${L?"bottom-0":"bottom-[60px]"} flex gap-px`,onSubmit:T,children:[x&&x!=="piazza"&&e.jsx(me,{trigger:e.jsx("button",{className:"px-1 h-full rounded bg-light-2 dark:bg-dark-2",type:"submit",children:e.jsx(Ye,{})}),title:e.jsx("div",{children:"전화 선택"}),content:e.jsxs("div",{className:"flex justify-center gap-5 p-5",children:[e.jsx(fe,{children:e.jsx(oe,{to:`/piazza?id=${x}?calls=video`,children:e.jsx(we,{className:"colorOne",sx:{height:"100%"},children:e.jsx(ye,{children:e.jsxs("div",{className:"flex flex-col items-center gap-5",onClick:()=>{var s;(s=document.getElementById("calls"))==null||s.click()},children:[e.jsx(Pe,{}),e.jsx("div",{children:"화상 전화"})]})})})})}),e.jsx(fe,{children:e.jsx(oe,{to:`/piazza?id=${x}?calls=audio`,children:e.jsx(we,{className:"colorOne",sx:{height:"100%"},children:e.jsx(ye,{children:e.jsxs("div",{className:"flex flex-col items-center gap-5",children:[e.jsx(Le,{}),e.jsx("div",{children:"음성 전화"})]})})})})})]})}),e.jsx("input",{className:"w-full p-3 rounded bg-light-1 dark:bg-dark-1",placeholder:qe[M],onChange:J,value:a,autoFocus:!0}),e.jsx("button",{className:"w-1/6 rounded bg-light-2 dark:bg-dark-2",type:"submit",children:Ke[M]})]})})}const De=({initiateContinuing:i,multiple:g,handleMultiple:z,user:a,userObj:o,handleMessagesList:U,displayedName:r})=>{const{state:I}=se(),L=(I==null?void 0:I.conversation)||"piazza",l=ae(x=>x.languages.value),[R,S]=d.useState("");return d.useEffect(()=>{a&&((a==null?void 0:a.uid)<o.uid?S((a==null?void 0:a.uid[0])+(a==null?void 0:a.uid[1])+(a==null?void 0:a.uid[2])+(a==null?void 0:a.uid[3])+(a==null?void 0:a.uid[4])+(a==null?void 0:a.uid[5])+o.uid[0]+o.uid[1]+o.uid[2]+o.uid[3]+o.uid[4]+o.uid[5]):S(o.uid[0]+o.uid[1]+o.uid[2]+o.uid[3]+o.uid[4]+o.uid[5]+(a==null?void 0:a.uid[0])+(a==null?void 0:a.uid[1])+(a==null?void 0:a.uid[2])+(a==null?void 0:a.uid[3])+(a==null?void 0:a.uid[4])+(a==null?void 0:a.uid[5])))},[a]),e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-col items-center pt-5",children:[e.jsx(ue,{element:a,uid:o.uid,profile:!0,profileColor:"",profileUrl:a==null?void 0:a.profileImageUrl,fallback:"",piazza:null}),e.jsx("div",{children:a==null?void 0:a.displayName}),(a==null?void 0:a.displayName)!==r&&e.jsx("div",{children:l==="ko"?e.jsxs("div",{children:["(",r,"에서 개명)"]}):e.jsxs("div",{children:["(Changed name from ",r,")"]})})]}),e.jsxs("div",{className:"flex justify-center p-5",children:[e.jsx(oe,{to:`/profile?id=${a==null?void 0:a.uid}`,state:{element:a},children:e.jsx(ne,{variant:"outlined",onClick:()=>{},children:l==="ko"?"프로필 확인":"Check Profile"})}),L==="piazza"&&o.uid!==(a==null?void 0:a.uid)&&e.jsx(oe,{to:`${location.pathname}?id=${R}`,state:{conversation:R,displayName:a==null?void 0:a.displayName,userUid:o.uid,chattingUid:a==null?void 0:a.uid,multiple:!1,profileUrl:a==null?void 0:a.profileImageUrl},children:e.jsx(fe,{children:e.jsx(ne,{variant:"outlined",onClick:()=>{U([]),z(!1),i()},children:l==="ko"?"개인 대화":"Private messaging"})})})]})]})};function Ie({userObj:i,multiple:g,handleMultiple:z,messagesList:a,handleMessagesList:o}){const U=d.useRef(null),r=d.useRef(null),[I,L]=d.useState(null),[l,R]=d.useState(""),[S,x]=d.useState(!1),[F,M]=d.useState(null),[v,E]=d.useState(0),[T,J]=d.useState("piazza"),{state:W}=se(),j=(W==null?void 0:W.conversation)||"piazza";d.useEffect(()=>{T!==j&&(o([]),M(null),E(0),J(j))},[j]);const y=ae(t=>t.languages.value),s=async({userUid:t,displayName:c})=>{const n=H(P,`members/${t}`),f=(await _(n)).data();L(f),R(c),console.log("practice")},C=({userUid:t,displayName:c})=>{var n;(n=document.getElementById("drawer"))==null||n.click(),s({userUid:t,displayName:c})},b=20;d.useEffect(()=>{if(!X)return;function t(c){const{msg:n,userUid:w,id:f,target:h,messageClock:m,messageClockNumber:u,profileImageUrl:p,defaultProfile:N,profileImage:D,conversation:A}=c;o(V=>[...V,{msg:n,type:h?"private":"other",userUid:w,id:f,messageClock:m,messageClockNumber:u,conversation:null,profileImageUrl:p,defaultProfile:N,profileImage:D}])}return X.on("sMessagePiazza",t),()=>{X.off("sMessagePiazza",t)}},[]),d.useEffect(()=>{if(!X)return;function t(c){const{msg:n,userUid:w,id:f,target:h,messageClock:m,messageClockNumber:u,conversation:p,profileImageUrl:N,defaultProfile:D,profileImage:A,piazzaData:V}=c;o(B=>[...B,{msg:n,type:h?"private":"other",userUid:w,id:f,messageClock:m,messageClockNumber:u,conversation:null,profileImageUrl:N,defaultProfile:D,profileImage:A,...V}])}return X.on(`sMessage${j}`,t),()=>{X.off(`sMessage${j}`,t)}},[]),d.useEffect(()=>{document.documentElement.scrollTo({top:0,left:0,behavior:"instant"})},[]),d.useEffect(()=>{$(),(async()=>{if(g){const c=te(P,"chats_group"),n=ce(c,de("messageClockNumber","desc"),re(1));(await ge(n)).forEach(async f=>{const h=H(P,`chats_group/${f.id}`),u=(await _(h)).data(),p=u.piazzaChecked||[];p.indexOf(i.uid)===-1&&(p.splice(-1,i.uid,0),p.push(i.uid),await ee(h,{...u,piazzaChecked:p}))})}else{const c=H(P,`members/${i.uid}`),w=(await _(c)).data().chattings;w[j]&&(w[j].messageCount=0),await ee(c,{chattings:w})}})()},[a]);const $=()=>{var t;(t=U.current)==null||t.scrollIntoView()};d.useEffect(()=>{const t=async()=>{const n=[],w=te(P,"chats_group"),f=ce(w,de("messageClockNumber","desc"),re(b),Ce(F||"")),h=await ge(f);h.docs.length||E(h.docs.length),h.forEach(m=>{var Z,G,q;n.length===h.docs.length-1&&(M(m),E(h.docs.length-1));const u=m.data().message,p=m.data().userUid,N=m.data().userName,D=m.data().messageClock,A=m.data().messageClockNumber,V=(Z=m.data())==null?void 0:Z.profileImageUrl,B=(G=m.data())==null?void 0:G.defaultProfile,Y=(q=m.data())==null?void 0:q.profileImage,Q=m.data();n.push({msg:u,userUid:p,id:N,messageClockNumber:A,messageClock:D,conversation:null,profileImageUrl:V,defaultProfile:B,profileImage:Y||!1,...Q})}),n.reverse(),o([...n,...a]),x(!1)},c=async n=>{const w=te(P,`chats_${n}`),f=ce(w,de("messageClockNumber","desc"),re(b),Ce(F||"")),h=await ge(f),m=[];h.docs.length||E(h.docs.length),h.forEach((u,p)=>{var q,K,O;m.length===h.docs.length-1&&(M(u),E(h.docs.length-1));const N=u.data().message,D=u.data().userUid,A=u.data().userName,V=u.data().messageClock,B=u.data().messageClockNumber||0,Y=(q=u.data())==null?void 0:q.profileImageUrl,Q=(K=u.data())==null?void 0:K.defaultProfile,Z=(O=u.data())==null?void 0:O.profileImage,G=u.data();m.push({msg:N,userUid:D,id:A,messageClockNumber:B,messageClock:V,conversation:null,profileImageUrl:Y,defaultProfile:Q,profileImage:Z||!1,...G})}),m.reverse(),o([...m,...a]),x(!1)};j==="piazza"?(S||!a.length)&&t():(S||!a.length)&&c(j)},[S,j]);const k=()=>{r.current.scrollTop!==0||S||(console.log("scroll"),x(!0))};return d.useEffect(()=>{var t;return(t=r.current)==null||t.addEventListener("scroll",k),()=>{var c;return(c=r.current)==null?void 0:c.removeEventListener("scroll",k)}},[S]),console.log(j),console.log(a),console.log(I),e.jsx(e.Fragment,{children:e.jsx("div",{ref:r,className:"p-1 border-t rounded-xl overflow-auto",children:e.jsxs("ul",{children:[S&&e.jsx("div",{className:"flex justify-center bg-light-2 dark:bg-dark-2 rounded",children:"로딩"}),a.map((t,c)=>{let n;j==="piazza"?n=t:t.userUid===t.userOne?n={userUid:t.userOne,id:t.userOneDisplayName,profileImage:t.userOneProfileImage||t.profileImage,defaultProfile:t.userOneDefaultProfile||t.defaultProfile,profileImageUrl:t.userOneProfileUrl||t.profileImageUrl}:n={userUid:t.userTwo,id:t.userTwoDisplayName,profileImage:t.userTwoProfileImage||t.profileImage,defaultProfile:t.userTwoDefaultProfile||t.defaultProfile,profileImageUrl:t.userTwoProfileUrl||t.profileImageUrl};let w;const f=new Date(t.messageClock);t.userUid===i.uid?w="text-right":w="text-left";let h,m;c>0&&(h=a[c-1].userUid),c<a.length-1&&a[c+1].userUid===i.uid&&(m=new Date(a[c+1].messageClock),f.getFullYear()===m.getFullYear()&&f.getMonth()===m.getMonth()&&f.getDate()===m.getDate()&&f.getHours()===m.getHours()&&(f.getMinutes(),m.getMinutes()));let u,p=f.getHours(),N=(f.getMonth()+1).toString(),D=f.getDate().toString();return p>=13?(u="오후",p!==12&&(p=p-12)):(u="오전",p===0&&(p=p+12)),f.getMonth()+1<10&&(N="0"+N),D.length===1&&(D="0"+D),e.jsxs("li",{ref:c===v?U:null,className:w,children:[h!==t.userUid&&e.jsx("div",{children:e.jsx("div",{className:`flex justify-${t.userUid!==i.uid?"start":"end"}`,children:w==="text-left"?e.jsxs("div",{className:"flex gap-3",children:[e.jsx(me,{trigger:e.jsx(ue,{element:n,piazza:()=>C({userUid:n.userUid,displayName:n.id}),profile:!1}),title:e.jsx(ze,{}),content:e.jsx(De,{initiateContinuing:()=>M(null),multiple:g,handleMultiple:z,user:I,userObj:i,handleMessagesList:o,displayedName:l})}),e.jsx("div",{children:t.id})]}):e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{children:t.id}),e.jsx(me,{trigger:e.jsx(ue,{element:n,piazza:()=>C({userUid:n.userUid,displayName:n.id}),profile:!1}),title:e.jsx(ze,{}),content:e.jsx(De,{initiateContinuing:()=>M(null),multiple:g,handleMultiple:z,user:I,userObj:i,handleMessagesList:o,displayedName:l})})]})})}),t.userUid!==i.uid?e.jsxs("div",{className:"flex gap-3 justify-start",children:[e.jsx("div",{className:"other rounded-tr-lg rounded-bl-lg rounded-br-lg p-1 bg-light-1 dark:bg-dark-1",children:t.msg}),e.jsxs("div",{children:[f.getFullYear(),"-",N,"-",D," ",y==="ko"&&u," ",p,":",f.getMinutes()<10&&"0",f.getMinutes(),y==="en"&&(u==="오전"?"am":"pm")]})]}):e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsxs("div",{children:[f.getFullYear(),"-",N,"-",D," ",y==="ko"&&u," ",p,":",f.getMinutes()<10&&"0",f.getMinutes(),y==="en"&&(u==="오전"?"am":"pm")]}),e.jsx("div",{className:"me rounded-tl-lg rounded-bl-lg rounded-br-lg p-1 bg-light-1 dark:bg-dark-1",children:t.msg})]})]},c)}),e.jsx("li",{ref:U})]})})})}function Ge({isKeyboardOpen:i,userObj:g,multiple:z,handleMultiple:a,messagesList:o,handleMessagesList:U}){return e.jsx(e.Fragment,{children:i?e.jsx("div",{className:"fixed bottom-[50px] w-screen h-full bg-light-3 dark:bg-dark-3 flex flex-col pt-[120px]",children:e.jsx(Ie,{userObj:g,multiple:z,handleMultiple:a,messagesList:o,handleMessagesList:U})}):e.jsx("div",{className:"fixed bottom-[110px] w-screen h-[60%] bg-light-3 dark:bg-dark-3 flex flex-col",children:e.jsx(Ie,{userObj:g,multiple:z,handleMultiple:a,messagesList:o,handleMessagesList:U})})})}const Xe=Ee(Te)(({theme:i})=>({padding:8,"& .MuiSwitch-track":{borderRadius:22/2,"&::before, &::after":{content:'""',position:"absolute",top:"50%",transform:"translateY(-50%)",width:16,height:16},"&::before":{backgroundImage:`url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" height="16" width="16" viewBox="0 0 24 24"><path fill="${encodeURIComponent(i.palette.getContrastText(i.palette.primary.main))}" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"/></svg>')`,left:12},"&::after":{backgroundImage:`url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" height="16" width="16" viewBox="0 0 24 24"><path fill="${encodeURIComponent(i.palette.getContrastText(i.palette.primary.main))}" d="M19,13H5V11H19V13Z" /></svg>')`,right:12}},"& .MuiSwitch-thumb":{boxShadow:"none",width:16,height:16,margin:2}}));function Je(){const i=ae(o=>o.languages.value),g=ie(o=>o.piazzaSwitch.value),z=pe(),a=()=>{g==="true"?(window.localStorage.setItem("piazza","false"),z(Ne("false"))):(window.localStorage.setItem("piazza","true"),z(Ne("true")))};return e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"text-sm",children:i==="ko"?"단체 대화 알림 받기":"Receive Group Messaging notice"}),e.jsx("div",{className:"flex justify-end",children:e.jsx(Xe,{onClick:()=>a(),inputProps:{"aria-label":"ant design"},checked:g==="true"})})]})}const Se={ko:["단체 대화","개인 대화"],en:["Group Messaging","Messaging"]},Qe=({multiple:i,displayName:g})=>{const z=ae(r=>r.languages.value),a=z==="ko"||z==="en"?z:"ko",{state:o}=se(),U=(o==null?void 0:o.conversation)||"piazza";return e.jsxs("div",{className:"flex w-screen justify-between",children:[e.jsx($e,{icon:e.jsx(Re,{}),title:U==="piazza"?Se[a][0]:`${Se[a][1]} ${g}`}),i&&e.jsx("div",{className:"flex w-1/2 justify-end px-5 pt-5",children:e.jsx(Je,{})})]})};function We(){const[i,g]=d.useState([]),[z,a]=d.useState(!0),[o,U]=d.useState(!0),[r,I]=d.useState(""),[L,l]=d.useState(null),[R,S]=d.useState(null),x=Fe(),F=document.getElementById("myScreen"),M=document.getElementById("devices"),v={audio:!0,video:!0};async function E(){const y=R;y&&y.getAudioTracks().forEach(s=>s.enabled=!s.enabled),a(!z)}async function T(){const y=R;y&&y.getVideoTracks().forEach(s=>s.enabled=!s.enabled),U(!o)}async function J(){console.log(M.value),R.getTracks().forEach(s=>s.stop()),l(M.value),await j(M.value)}d.useEffect(()=>{j(L)},[M]);async function W(){try{const s=(await navigator.mediaDevices.enumerateDevices()).filter(C=>C.kind==="videoinput");g(s)}catch(y){console.log(y)}}async function j(y){try{const C=y?{audio:!0,video:{deviceId:{exact:y}}}:v,b=await navigator.mediaDevices.getUserMedia(C),$=await navigator.mediaDevices.enumerateDevices();S(b),F.srcObject=b,await W(),I("")}catch(s){console.log(s),I(s)}}return e.jsxs("div",{id:"myStream",children:[e.jsxs("div",{className:`flex ${!x&&"flex-col"} gap-1`,children:[e.jsx("video",{id:"myScreen",width:"320",height:"240",controls:!0,autoPlay:!0}),e.jsx("video",{id:"yourScreen",width:"320",height:"240",controls:!0,autoPlay:!0})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex gap-5",children:[e.jsx(ne,{onClick:E,children:z?"unmute":"mute"}),e.jsx(ne,{onClick:T,children:o?"turn stream on":"turn stream off"})]}),e.jsx("select",{id:"devices",onChange:J,children:i.map((y,s)=>e.jsx("option",{value:y.deviceId,children:y.label},s))})]}),r&&e.jsx("div",{children:r})]})}function aa({userObj:i}){const[g,z]=d.useState(""),[a,o]=d.useState([]),U=pe(),{state:r}=se(),[I,L]=d.useState(!0),[l,R]=d.useState(!1),[S,x]=d.useState(null);r!=null&&r.conversation,console.log(r),d.useEffect(()=>{const v=async()=>{if(r!=null&&r.chattingUid){const E=H(P,`members/${r.chattingUid}`),T=await _(E);x(T.data())}};r!=null&&r.multiple||v()},[r]);const F=ie(v=>v.piazzaForm.value);d.useEffect(()=>{var E;const v=()=>{var J;const T=window.screen.height-300>(((J=window.visualViewport)==null?void 0:J.height)||window.screen.height);l!==T&&R(T)};return window.addEventListener("resize",v),typeof visualViewport<"u"&&((E=window.visualViewport)==null||E.addEventListener("resize",v)),visualViewport==null||visualViewport.addEventListener("resize",v),typeof visualViewport<"u"&&(visualViewport==null||visualViewport.addEventListener("resize",v)),()=>{var T;typeof visualViewport<"u"&&((T=window.visualViewport)==null||T.removeEventListener("resize",v))}},[l]),d.useEffect(()=>{(r==null?void 0:r.multiple)!==void 0&&L(r==null?void 0:r.multiple)},[]),d.useEffect(()=>{U(Ve(5))});const M=r==null?void 0:r.displayName;return e.jsxs(e.Fragment,{children:[!l&&e.jsx(Qe,{multiple:I,displayName:M}),e.jsx(Ge,{isKeyboardOpen:F,userObj:i,multiple:I,handleMultiple:v=>L(v),messagesList:a,handleMessagesList:v=>o(v)}),e.jsx(Ze,{chattingUser:S,userObj:i,multiple:I,messages:g,handleMessages:v=>z(v),messagesList:a,handleMessagesList:v=>o(v)}),e.jsxs(Be,{children:[e.jsx(Ae,{children:e.jsx("div",{id:"calls"})}),e.jsx(He,{children:e.jsxs("div",{children:[e.jsx("div",{className:"flex gap-5",children:e.jsx(We,{})}),e.jsx(_e,{children:e.jsx("div",{children:"전화 종료"})})]})})]})]})}export{aa as default};
