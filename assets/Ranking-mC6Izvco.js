import{c as H,M as I,j as e,T as M,r as a,q as L,aH as R,U as $,E as U,f as b,g as S,h as D,t as N,m as T,n as C,k as q,V as Q,K,a5 as O,w as P}from"./index-C1j4iGXn.js";import{L as w}from"./Lists-DcdlQZhe.js";function V({changeUserSearch:o}){const l=H(r=>r.languages.value),s=r=>{const{target:{value:h}}=r;o(h)},{colorOne:u,colorTwo:i}=I();return e.jsx("div",{className:"px-5 flex flex-col",children:e.jsx(M,{sx:{bgcolor:i,borderRadius:"5px"},label:l==="ko"?"유저 이름":"User name",onChange:s})})}function z({userObj:o,userSearch:l}){const[s,u]=a.useState([]),[i,r]=a.useState([]),[h,j]=a.useState([]),[x,v]=a.useState(null),[g,p]=a.useState(!1);a.useState(!1);const A=20;a.useEffect(()=>{const B=async()=>{const k=L(b(S,"members"),U("points","desc"),$(A),R(x||"")),f=await D(k),m=f.docs.map((n,d)=>{var c;if(console.log(s.indexOf(n)),s.indexOf(n)===-1)return N(T(C,`${(c=n.data())==null?void 0:c.uid}`)).then(t=>{j([...h,{url:t,index:d}])}).catch(t=>{console.log(t)}),d+1===f.docs.length&&v(n),{...n.data()}});if(u([...s,...m]),i.length===0){const n=q(S,`members/${o.uid}`),c=(await Q(n)).data();console.log(c),m.map((t,E)=>{t.uid===o.uid&&(console.log(t==null?void 0:t.ranking),m[E].rank=E+1)}),r([c])}p(!1)},F=async()=>{const k=L(b(S,"members"),U("points","desc"),R(x||"")),f=await D(k),m=f.docs.map((n,d)=>{var c;if(console.log(s.indexOf(n)),s.indexOf(n)===-1)return N(T(C,`${(c=n.data())==null?void 0:c.uid}`)).then(t=>{j([...h,{url:t,index:d}])}).catch(t=>{console.log(t)}),d+1===f.docs.length&&v(n),{...n.data()}});u([...s,...m]),p(!1)};(g||s.length===0)&&B(),l&&(F(),console.log(l))},[g,l]);const y=()=>{if(window.innerHeight+Math.round(document.documentElement.scrollTop)!==document.documentElement.offsetHeight||g){console.log(document.documentElement.offsetHeight);return}else console.log("scroll"),p(!0)};return a.useEffect(()=>(window.addEventListener("scroll",y),()=>window.removeEventListener("scroll",y)),[g]),e.jsx(e.Fragment,{children:l?e.jsx("div",{children:e.jsx(w,{userObj:o,elements:s,multiple:!0,userSearch:l,ranking:!0,handleUser:null})}):e.jsxs("div",{children:[e.jsx(w,{userObj:o,elements:i,multiple:!1,userSearch:null,ranking:!0,handleUser:null}),e.jsx(w,{userObj:o,elements:s,multiple:!0,userSearch:null,ranking:!0,handleUser:null}),!g&&e.jsx("div",{className:"p-28"}),g&&e.jsx("div",{className:"flex justify-center text-2xl p-28 bg-light-2 dark:bg-dark-2 rounded",children:"로딩"})]})})}function W({userObj:o}){const[l,s]=a.useState(""),u=H(r=>r.languages.value),i=K();return a.useEffect(()=>{i(O(5))}),e.jsxs(e.Fragment,{children:[e.jsx(P,{title:u==="ko"?"유저 랭킹":"User Ranking"}),e.jsx(V,{changeUserSearch:r=>s(r)}),e.jsx(z,{userObj:o,userSearch:l})]})}export{W as default};
