import{r as a,j as e,U as L,bj as E,a8 as I,V as D,W as R,O as p,X as U,aC as N,az as b,aA as A,N as $,a5 as B,a2 as M,ap as P}from"./index-B_d1dMZj.js";import{P as Q}from"./PageTitle-CbwRuwRC.js";import{L as j}from"./Lists-gBJfodmV.js";import{T as q}from"./TextField-B-g8UoeG.js";function z({userObj:o,userSearch:l}){const[s,c]=a.useState([]),[u,C]=a.useState([]),[S,k]=a.useState([]),[m,w]=a.useState(null),[i,h]=a.useState(!1);a.useState(!1);const T=20;a.useEffect(()=>{const F=async()=>{const x=L(R(p,"members"),D("points","desc"),I(T),E(m||"")),g=await U(x),f=g.docs.map((t,d)=>{var r;if(console.log(s.indexOf(t)),s.indexOf(t)===-1)return N(b(A,`${(r=t.data())==null?void 0:r.uid}`)).then(n=>{k([...S,{url:n,index:d}])}).catch(n=>{console.log(n)}),d+1===g.docs.length&&w(t),{...t.data()}});if(c([...s,...f]),u.length===0){const t=$(p,`members/${o.uid}`),r=(await B(t)).data();console.log(r),f.map((n,v)=>{n.uid===o.uid&&(console.log(n==null?void 0:n.ranking),f[v].rank=v+1)}),C([r])}h(!1)},H=async()=>{const x=L(R(p,"members"),D("points","desc"),E(m||"")),g=await U(x),f=g.docs.map((t,d)=>{var r;if(console.log(s.indexOf(t)),s.indexOf(t)===-1)return N(b(A,`${(r=t.data())==null?void 0:r.uid}`)).then(n=>{k([...S,{url:n,index:d}])}).catch(n=>{console.log(n)}),d+1===g.docs.length&&w(t),{...t.data()}});c([...s,...f]),h(!1)};(i||s.length===0)&&F(),l&&(H(),console.log(l))},[i,l]);const y=()=>{if(window.innerHeight+Math.round(document.documentElement.scrollTop)!==document.documentElement.offsetHeight||i){console.log(document.documentElement.offsetHeight);return}else console.log("scroll"),h(!0)};return a.useEffect(()=>(window.addEventListener("scroll",y),()=>window.removeEventListener("scroll",y)),[i]),e.jsx(e.Fragment,{children:l?e.jsx("div",{children:e.jsx(j,{userObj:o,elements:s,multiple:!0,userSearch:l,ranking:!0,handleUser:null})}):e.jsxs("div",{children:[e.jsx(j,{userObj:o,elements:u,multiple:!1,userSearch:null,ranking:!0,handleUser:null}),e.jsx(j,{userObj:o,elements:s,multiple:!0,userSearch:null,ranking:!0,handleUser:null}),!i&&e.jsx("div",{className:"p-28"}),i&&e.jsx("div",{className:"flex justify-center text-2xl p-28",children:"loading"})]})})}function O({changeUserSearch:o}){const l=s=>{const{target:{value:c}}=s;o(c)};return e.jsx("div",{className:"px-5 flex flex-col",children:e.jsx(q,{label:"유저 이름",onChange:l})})}function J({userObj:o}){const[l,s]=a.useState(""),c=M();return a.useEffect(()=>{c(P(5))}),e.jsxs(e.Fragment,{children:[e.jsx(Q,{title:"유저 랭킹"}),e.jsx(O,{changeUserSearch:u=>s(u)}),e.jsx(z,{userObj:o,userSearch:l})]})}export{J as default};
