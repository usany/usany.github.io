import{u as U,a as L,b as V,j as e,T as $,r as f,c as z,L as T,d as G,q as R,s as C,l as J,o as N,e as A,g as B,f as K,h as y,i as W,k as X,P as Y,S as Z}from"./index-I1ZpWzgW.js";import{R as D}from"./RankingListsTitle-8xu9Du5X.js";function _(){const[n,t]=U(),{userName:h}=L(),l=o=>{const{target:{value:i}}=o;t(m=>(m.set("search",i),i||m.delete("search"),m))},{colorTwo:g}=V(),a=n.get("search");return e.jsx("div",{className:"px-5 flex justify-center",children:e.jsx($,{sx:{width:"1000px",bgcolor:g,borderRadius:"5px"},value:a,label:h,onChange:l})})}let F,p;function H({multiple:n}){const[t,h]=f.useState([]),[l,g]=f.useState(null),[a,o]=f.useState(!1),[i,m]=U(),q=20,{loading:I}=L(),r=i.get("search"),c=z(j=>j.profile.value);if(i.get("search")&&!n)return null;if(!n)return e.jsx(T,{elements:[c],userSearch:null,multiple:!1,handleUser:null});const M=G();f.useEffect(()=>{const j=async()=>{const S=R(A(y,"members"),N("points","desc"),J(q),C(l||"")),u=await B(S),b=t.length,d=u.docs.map((s,k)=>{var E,P;s.data().points!==F&&(F=s.data().points,p=b+k);const Q=K(y,`members/${s==null?void 0:s.id}`),w=p?p+1:k+1;if(((E=s.data())==null?void 0:E.ranking)!==w&&n&&(console.log((P=s.data())==null?void 0:P.ranking),W(Q,{ranking:w}),s.id===(c==null?void 0:c.uid)&&M(X({...c,ranking:w}))),r){for(let x=0;x<r.length;x++)if(s.data().displayName[x]!==r[x])return null}return t.indexOf(s)===-1?(k+1===u.docs.length&&g(s),{...s.data(),ranking:p+1}):null});h([...t,...d]),o(!1)},O=async()=>{const S=R(A(y,"members"),N("points","desc"),C(l||"")),u=await B(S),b=u.docs.map((d,s)=>t.indexOf(d)===-1?(s+1===u.docs.length&&g(d),{...d.data()}):null);h([...t,...b]),o(!1)};(a||t.length===0)&&j(),r&&O()},[a,r]);const v=()=>{if(document.documentElement.offsetHeight-(window.innerHeight+Math.round(document.documentElement.scrollTop))>250||a){console.log(document.documentElement.offsetHeight);return}else console.log("scroll"),o(!0)};return f.useEffect(()=>(window.addEventListener("scroll",v),()=>window.removeEventListener("scroll",v)),[a]),e.jsxs(e.Fragment,{children:[e.jsx(T,{elements:t,multiple:!0,userSearch:r,handleUser:null}),r&&a&&e.jsx("div",{className:"flex justify-center text-2xl bg-light-2 dark:bg-dark-2 rounded",children:I})]})}function te(){const{userSearch:n}=L();return e.jsxs(e.Fragment,{children:[e.jsx(Y,{icon:e.jsx(Z,{}),title:n}),e.jsx(_,{}),e.jsx(D,{multiple:!1}),e.jsx(H,{multiple:!1}),e.jsx(D,{multiple:!0}),e.jsx(H,{multiple:!0})]})}export{te as default};
