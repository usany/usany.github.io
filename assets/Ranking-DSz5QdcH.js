import{m as N,Y as H,j as e,T as $,r as a,t as E,aL as R,a3 as M,O as U,v as b,w as S,x as D,G as C,C as T,E as I,z as O,a4 as Q,W as q,ag as z,I as G}from"./index-CXcEIG7m.js";import{L as w}from"./Lists-C-sm9WDB.js";function P({changeUserSearch:o}){const l=N(r=>r.languages.value),s=r=>{const{target:{value:h}}=r;o(h)},{colorOne:d,colorTwo:i}=H();return e.jsx("div",{className:"px-5 flex flex-col",children:e.jsx($,{sx:{bgcolor:i,borderRadius:"5px"},label:l==="ko"?"유저 이름":"User name",onChange:s})})}function W({userObj:o,userSearch:l}){const[s,d]=a.useState([]),[i,r]=a.useState([]),[h,v]=a.useState([]),[x,j]=a.useState(null),[u,p]=a.useState(!1);a.useState(!1);const A=20;a.useEffect(()=>{const B=async()=>{const k=E(b(S,"members"),U("points","desc"),M(A),R(x||"")),f=await D(k),m=f.docs.map((n,g)=>{var c;if(console.log(s.indexOf(n)),s.indexOf(n)===-1)return C(T(I,`${(c=n.data())==null?void 0:c.uid}`)).then(t=>{v([...h,{url:t,index:g}])}).catch(t=>{console.log(t)}),g+1===f.docs.length&&j(n),{...n.data()}});if(d([...s,...m]),i.length===0){const n=O(S,`members/${o.uid}`),c=(await Q(n)).data();console.log(c),m.map((t,L)=>{t.uid===o.uid&&(console.log(t==null?void 0:t.ranking),m[L].rank=L+1)}),r([c])}p(!1)},F=async()=>{const k=E(b(S,"members"),U("points","desc"),R(x||"")),f=await D(k),m=f.docs.map((n,g)=>{var c;if(console.log(s.indexOf(n)),s.indexOf(n)===-1)return C(T(I,`${(c=n.data())==null?void 0:c.uid}`)).then(t=>{v([...h,{url:t,index:g}])}).catch(t=>{console.log(t)}),g+1===f.docs.length&&j(n),{...n.data()}});d([...s,...m]),p(!1)};(u||s.length===0)&&B(),l&&(F(),console.log(l))},[u,l]);const y=()=>{if(document.documentElement.offsetHeight-(window.innerHeight+Math.round(document.documentElement.scrollTop))>10||u){console.log(document.documentElement.offsetHeight);return}else console.log("scroll"),p(!0)};return a.useEffect(()=>(window.addEventListener("scroll",y),()=>window.removeEventListener("scroll",y)),[u]),e.jsx(e.Fragment,{children:l?e.jsx("div",{children:e.jsx(w,{userObj:o,elements:s,multiple:!0,userSearch:l,ranking:!0,handleUser:null})}):e.jsxs("div",{children:[e.jsx(w,{userObj:o,elements:i,multiple:!1,userSearch:null,ranking:!0,handleUser:null}),e.jsx(w,{userObj:o,elements:s,multiple:!0,userSearch:null,ranking:!0,handleUser:null}),u&&e.jsx("div",{className:"flex justify-center text-2xl bg-light-2 dark:bg-dark-2 rounded",children:"로딩"})]})})}function K({userObj:o}){const[l,s]=a.useState(""),d=N(r=>r.languages.value),i=q();return a.useEffect(()=>{i(z(5))}),e.jsxs(e.Fragment,{children:[e.jsx(G,{title:d==="ko"?"유저 랭킹":"User Ranking"}),e.jsx(P,{changeUserSearch:r=>s(r)}),e.jsx(W,{userObj:o,userSearch:l})]})}export{K as default};
